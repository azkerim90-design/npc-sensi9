<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NPC SENSÄ° | INFINITY PRIME V4.0 ULTRA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        /* --- INFINITY PRIME STÄ°LLERÄ° --- */
        :root { --npc-red: #ff0000; --npc-gold: #ffd700; --npc-blue: #00f0ff; --bg: #050505; --card-bg: rgba(15, 15, 15, 0.92); --text: #ffffff; --input-bg: #151515; --border: rgba(255,255,255,0.1); }
        body { background: radial-gradient(circle at center, #0a0000 0%, #000000 100%); font-family: 'Montserrat', sans-serif; color: var(--text); overflow-x: hidden; transition: 0.4s; padding-top: 80px; padding-bottom: 120px; }
        .page { position: fixed; inset: 0; top: 50px; bottom: 90px; background: transparent; transition: 0.4s; overflow-y: auto; z-index: 10; padding: 20px; }
        .page-hidden { transform: translateX(120%) scale(0.85); opacity: 0; pointer-events: none; filter: blur(15px); }
        .xp-wrapper { width: 100%; margin: 20px 0; position: relative; }
        .xp-header { display: flex; justify-content: space-between; font-size: 10px; font-weight: 700; color: #888; margin-bottom: 5px; letter-spacing: 1px; }
        .xp-track { width: 100%; height: 12px; background: #111; border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: inset 0 0 10px #000; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, #ff0000, #ff4d00, #ffd700); width: 0%; transition: 1.5s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 15px rgba(255, 69, 0, 0.8); position: relative; }
        .xp-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.2) 75%, transparent 75%, transparent); background-size: 10px 10px; animation: moveStripes 1s linear infinite; }
        @keyframes moveStripes { 0% { background-position: 0 0; } 100% { background-position: 10px 10px; } }
        .brand-name { font-size: 9px; font-weight: 500; color: #aaa; letter-spacing: 1px; margin-top: 5px; }
        .category-text { font-size: 10px; font-weight: 500; letter-spacing: 2px; color: #ddd; }
        .gold-name { color: #ffd700 !important; text-shadow: 0 0 10px rgba(255, 215, 0, 0.6); font-weight: 800; }
        .neon-border { border: 3px solid #00f0ff !important; box-shadow: 0 0 25px #00f0ff; }
        .fire-border { border: 3px solid #ff4500 !important; box-shadow: 0 0 25px #ff4500; animation: firePulse 2s infinite; }
        @keyframes firePulse { 0% { box-shadow: 0 0 15px #ff4500; } 50% { box-shadow: 0 0 30px #ff8800; } 100% { box-shadow: 0 0 15px #ff4500; } }
        .blue-chat-text { color: #00f0ff !important; text-shadow: 0 0 5px #00f0ff; }
        .crown-icon::after { content: ' ğŸ‘‘'; font-size: 14px; }
        .marquee-container { position: fixed; top: 0; left: 0; width: 100%; height: 40px; background: linear-gradient(90deg, #800000, #ff0000); z-index: 4000; display: flex; align-items: center; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        .marquee-text { white-space: nowrap; animation: scroll 30s linear infinite; font-family: 'Orbitron'; font-weight: 700; font-size: 12px; color: white; letter-spacing: 2px; }
        @keyframes scroll { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }
        .spider-container { position: absolute; top: -100px; left: 30px; z-index: 10001; animation: spiderDrop 1.5s cubic-bezier(0.5, 0, 0.5, 1.5) forwards 0.5s; pointer-events: none; }
        .spider-web { width: 2px; height: 100px; background: rgba(255,255,255,0.3); margin-left: 24px; }
        .nav-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(10,10,10,0.9); backdrop-filter: blur(20px); padding: 12px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); display: flex; gap: 20px; z-index: 9999; box-shadow: 0 10px 40px rgba(0,0,0,0.8); width: 95%; max-width: 450px; justify-content: center; overflow-x: auto; }
        .nav-icon { font-size: 20px; cursor: pointer; opacity: 0.6; transition: 0.3s; padding: 5px; flex-shrink: 0; color: white; }
        .nav-icon:hover, .nav-icon.active { opacity: 1; transform: translateY(-5px); color: var(--npc-red); text-shadow: 0 0 15px red; }
        .brand-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; margin-bottom: 20px; }
        .brand-card { min-width: 75px; height: 75px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 18px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .brand-card:active { background: var(--npc-red); transform: scale(0.95); border-color: var(--npc-red); }
        .brand-icon { font-size: 20px; margin-bottom: 4px; }
        .chat-bubble { padding: 10px 15px; border-radius: 18px; margin-bottom: 10px; max-width: 85%; position: relative; font-size: 12px; font-weight: 500; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .chat-mine { background: linear-gradient(135deg, #cc0000, #990000); color: white; align-self: flex-end; border-bottom-right-radius: 2px; margin-left: auto; }
        .chat-other { background: #1a1a1a; border: 1px solid #333; align-self: flex-start; border-bottom-left-radius: 2px; color: #ddd; }
        input, select { background: #1a1a1a; border: 1px solid #333; color: white; padding: 15px; border-radius: 15px; width: 100%; text-align: center; font-weight: 600; outline: none; margin-bottom: 10px; font-size: 13px; }
        input:focus { border-color: var(--npc-red); box-shadow: 0 0 15px rgba(255,0,0,0.3); }
        .toast-notification { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(50px); background: #fff; border: 2px solid var(--npc-red); color: black; padding: 12px 24px; border-radius: 50px; font-size: 12px; font-weight: 900; z-index: 10000; opacity: 0; transition: 0.4s; display: flex; gap: 10px; pointer-events: none; box-shadow: 0 0 20px rgba(255,0,0,0.5); }
        .toast-show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .admin-modal { position: fixed; inset: 0; z-index: 20000; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(10px); }
        
        /* PROFÄ°L STÄ°LLERÄ° */
        .profile-header { position: relative; width: 100%; height: 200px; overflow: hidden; border-radius: 0 0 50px 50px; margin-bottom: 70px; mask-image: linear-gradient(to bottom, black 80%, transparent 100%); border-bottom: 2px solid var(--npc-red); }
        .profile-cover { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; filter: hue-rotate(320deg); }
        .profile-avatar-wrapper { position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); width: 120px; height: 120px; border-radius: 50%; border: 4px solid #000; overflow: hidden; z-index: 5; box-shadow: 0 0 30px rgba(255,0,0,0.5); background: #000; }
        .profile-img { width: 100%; height: 100%; object-fit: cover; }
        .profile-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 400px; }
        .p-tab-btn { flex: 1; background: #222; border: 1px solid #444; color: #888; padding: 10px; border-radius: 12px; font-size: 10px; font-weight: 800; transition: 0.3s; }
        .p-tab-btn.active { background: var(--npc-red); color: white; border-color: var(--npc-red); box-shadow: 0 0 15px rgba(255,0,0,0.4); }
        .bio-box { width: 100%; max-width: 350px; text-align: center; margin-bottom: 20px; position: relative; }
        .bio-text { font-size: 11px; color: #ccc; font-style: italic; line-height: 1.4; border-left: 2px solid var(--npc-red); padding-left: 10px; display: inline-block; }
        .edit-bio-btn { font-size: 10px; color: var(--npc-blue); cursor: pointer; margin-left: 5px; opacity: 0.7; }
        
        /* OYUN & MAÄAZA KARTLARI */
        .shop-card { background: linear-gradient(145deg, #151515, #0a0a0a); border: 1px solid var(--border); border-radius: 20px; padding: 15px; text-align: center; position: relative; overflow: hidden; transition: 0.3s; margin-bottom: 10px; }
        .shop-price { background: var(--npc-gold); color: black; font-weight: 900; font-size: 10px; padding: 4px 10px; border-radius: 20px; display: inline-block; margin-top: 10px; }
        .shop-bought { background: #333; color: #fff; opacity: 0.5; cursor: default; }
        .shop-icon { font-size: 30px; margin-bottom: 10px; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        #loadingOverlay { position: fixed; inset: 0; z-index: 50000; background: #000; display: flex; align-items: center; justify-content: center; transition: 0.5s; }
        .stats-panel { position: fixed; top: 50px; left: 15px; z-index: 3000; background: rgba(0,0,0,0.8); border-left: 3px solid var(--npc-red); padding: 10px 15px; border-radius: 0 15px 15px 0; backdrop-filter: blur(10px); display: flex; flex-direction: column; gap: 4px; box-shadow: 5px 5px 20px rgba(0,0,0,0.6); transform: translateX(-100%); animation: slideIn 1s forwards 0.5s; }
        @keyframes slideIn { to { transform: translateX(0); } }
        .stat-item { font-size: 10px; font-weight: 700; color: #ccc; display: flex; align-items: center; gap: 8px; }
        .stat-val { color: var(--npc-red); font-family: 'Orbitron'; font-size: 11px; text-shadow: 0 0 5px red; }
        
        /* GLITCH & LOGO ANÄ°MASYONU */
        .glitch-wrapper { position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
        .glitch-text { font-size: 60px; font-weight: 900; color: #fff; letter-spacing: 4px; position: relative; text-shadow: 2px 2px 0px #ff0000, -2px -2px 0px #00f0ff; animation: glitch-anim 2s infinite linear alternate-reverse; }
        @keyframes glitch-anim { 0% { text-shadow: 2px 2px 0px #ff0000, -2px -2px 0px #00f0ff; transform: translate(0); } 20% { text-shadow: -2px 2px 0px #ff0000, 2px -2px 0px #00f0ff; transform: translate(-1px, 1px); } 40% { text-shadow: 2px -2px 0px #ff0000, -2px 2px 0px #00f0ff; transform: translate(1px, -1px); } 60% { text-shadow: 0px 0px 5px #ff0000; transform: translate(0); } 80% { text-shadow: -1px -1px 0px #ff0000; transform: translate(-1px, 0); } 100% { text-shadow: 2px 2px 10px #ff0000; transform: translate(1px, 1px); } }
        .spider-logo { font-size: 60px; animation: spider-bounce 2s infinite ease-in-out; filter: drop-shadow(0 0 20px red); }
        @keyframes spider-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* YENÄ° EKLENEN STÄ°LLER */
        .h-scroll-wrapper { display: flex; overflow-x: auto; gap: 12px; padding: 10px 5px; scrollbar-width: none; -ms-overflow-style: none; scroll-behavior: smooth; }
        .h-scroll-wrapper::-webkit-scrollbar { display: none; }
        .h-category-tabs { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; }
        .h-tab-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; font-size: 10px; font-weight: 800; color: #888; white-space: nowrap; transition: 0.3s; }
        .h-tab-btn.active { background: var(--npc-red); color: white; border-color: var(--npc-red); box-shadow: 0 0 10px rgba(255,0,0,0.4); }
        .ach-card-h { min-width: 140px; max-width: 140px; background: linear-gradient(145deg, #151515, #0a0a0a); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 12px; display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; flex-shrink: 0; }
        .ach-card-h.claimed { border-color: #00ff00; background: rgba(0,255,0,0.05); }
        .shop-card-h { min-width: 110px; max-width: 110px; height: 150px; background: #111; border: 1px solid #333; border-radius: 15px; padding: 10px; text-align: center; display: flex; flex-direction: column; justify-content: space-between; flex-shrink: 0; }
        .section-title-sm { font-size: 10px; font-weight: 900; color: #666; text-transform: uppercase; margin-bottom: 5px; padding-left: 5px; border-left: 2px solid var(--npc-red); }

        /* KASA & HUD & ODA & KART STÄ°LLERÄ° */
        .vault-card { background: #111; border: 1px solid #333; border-radius: 15px; padding: 15px; margin-bottom: 10px; position: relative; overflow: hidden; display: flex; gap: 15px; align-items: center; }
        .vault-locked { opacity: 0.8; }
        .vault-locked::after { content: 'ğŸ”’'; position: absolute; right: 10px; top: 10px; font-size: 20px; }
        .vault-img { width: 80px; height: 80px; object-fit: cover; border-radius: 10px; filter: blur(5px); transition: 0.3s; }
        .vault-unlocked .vault-img { filter: none; }
        .hud-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .hud-card { background: #111; border: 1px solid #333; border-radius: 15px; overflow: hidden; position: relative; }
        .hud-img { width: 100%; height: 120px; object-fit: cover; }
        .upload-btn-area { border: 2px dashed #444; border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px; cursor: pointer; color: #888; font-size: 10px; font-weight: bold; }
        .upload-btn-area:hover { border-color: var(--npc-red); color: white; }
        .room-card { background: #1a1a1a; border-left: 4px solid var(--npc-red); padding: 15px; margin-bottom: 10px; border-radius: 10px; position: relative; }
        .room-tag { background: #333; padding: 3px 8px; border-radius: 5px; font-size: 9px; color: #ccc; }
        .pro-card-preview { width: 100%; height: 200px; background: linear-gradient(45deg, #111, #222); border: 2px solid var(--npc-gold); border-radius: 15px; position: relative; padding: 15px; display: flex; flex-direction: column; justify-content: space-between; overflow: hidden; }
        .pro-card-bg { position: absolute; top:0; left:0; width:100%; height:100%; opacity: 0.3; object-fit: cover; z-index: 0; }
        .auction-card { background: linear-gradient(145deg, #220000, #000); border: 1px solid #ff4400; padding: 15px; border-radius: 20px; text-align: center; margin-bottom: 20px; position: relative; overflow: hidden; }
        .auction-timer { font-family: 'Orbitron'; font-size: 20px; color: #ff4400; font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>

    <div id="loadingOverlay">
        <div class="text-center">
            <h1 class="text-5xl font-black text-red-600 italic animate-pulse tracking-tighter">INFINITY</h1>
            <p class="text-white text-[10px] tracking-[8px] mt-4 font-bold">SYSTEM ONLINE</p>
        </div>
    </div>

    <input type="file" id="avatarInput" accept="image/*" style="display:none" onchange="handleAvatarUpload()">
    <input type="file" id="hudInput" accept="image/*" style="display:none" onchange="handleHudUpload()">
    <input type="file" id="cardBgInput" accept="image/*" style="display:none" onchange="handleCardBgUpload()">
    <input type="file" id="adImgInput" accept="image/*" style="display:none" onchange="handleAdImgUpload()">
    <input type="file" id="vaultImgInput" accept="image/*" style="display:none" onchange="handleVaultImgUpload()">

    <div id="toast" class="toast-notification"><span class="text-xl">âœ…</span><span id="toastMsg">Ä°ÅŸlem BaÅŸarÄ±lÄ±!</span></div>

    <div class="marquee-container">
        <div class="marquee-text" id="marqueeText">NPC SENSÄ° INFINITY PRIME V4.0 - YENÄ°LÄ°KLER: ODA DUVARI, SQUAD SAVAÅLARI, PRO OYUNCU KARTI, QUÄ°Z VE Ä°HALE SÄ°STEMÄ° AKTÄ°F!</div>
    </div>

    <div id="rouletteModal" class="roulette-modal" style="display:none; position:fixed; inset:0; z-index:20000; background:rgba(0,0,0,0.9); flex-direction:column; align-items:center; justify-content:center;">
        <div class="wheel-container" style="position:relative; width:300px; height:300px; margin-bottom:30px;">
            <div class="wheel-arrow" style="position:absolute; top:-20px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-top:30px solid red; z-index:10;"></div>
            <div id="wheel" class="wheel" style="width:100%; height:100%; border-radius:50%; border:5px solid #fff; background:conic-gradient(#f00 0deg 60deg, #000 60deg 120deg, #f00 120deg 180deg, #000 180deg 240deg, #f00 240deg 300deg, #000 300deg 360deg); transition: transform 4s cubic-bezier(0.2,0.8,0.2,1); position:relative;">
                <div class="w-seg" style="position:absolute; top:50%; left:50%; width:100%; height:2px; background:transparent; transform:translate(-50%,-50%) rotate(30deg); text-align:right;"><span class="w-txt" style="display:inline-block; transform:translateX(-20px) rotate(-90deg); color:white; font-weight:bold;">0</span></div>
                <div class="w-seg" style="position:absolute; top:50%; left:50%; width:100%; height:2px; background:transparent; transform:translate(-50%,-50%) rotate(90deg); text-align:right;"><span class="w-txt" style="display:inline-block; transform:translateX(-20px) rotate(-90deg); color:white; font-weight:bold;">10</span></div>
                <div class="w-seg" style="position:absolute; top:50%; left:50%; width:100%; height:2px; background:transparent; transform:translate(-50%,-50%) rotate(150deg); text-align:right;"><span class="w-txt" style="display:inline-block; transform:translateX(-20px) rotate(-90deg); color:white; font-weight:bold;">20</span></div>
                <div class="w-seg" style="position:absolute; top:50%; left:50%; width:100%; height:2px; background:transparent; transform:translate(-50%,-50%) rotate(210deg); text-align:right;"><span class="w-txt" style="display:inline-block; transform:translateX(-20px) rotate(-90deg); color:white; font-weight:bold;">50</span></div>
                <div class="w-seg" style="position:absolute; top:50%; left:50%; width:100%; height:2px; background:transparent; transform:translate(-50%,-50%) rotate(270deg); text-align:right;"><span class="w-txt" style="display:inline-block; transform:translateX(-20px) rotate(-90deg); color:white; font-weight:bold;">100</span></div>
                <div class="w-seg" style="position:absolute; top:50%; left:50%; width:100%; height:2px; background:transparent; transform:translate(-50%,-50%) rotate(330deg); text-align:right;"><span class="w-txt" style="display:inline-block; transform:translateX(-20px) rotate(-90deg); color:white; font-weight:bold;">500</span></div>
            </div>
        </div>
        <button id="spinBtn" onclick="spinRoulette()" class="bg-yellow-500 text-black px-8 py-4 rounded-full font-black text-xl shadow-[0_0_20px_gold] animate-pulse">Ã‡EVÄ°R</button>
        <button onclick="document.getElementById('rouletteModal').style.display='none'" class="mt-4 text-gray-500 text-xs underline">KAPAT</button>
    </div>

    <div class="stats-panel">
        <div class="stat-item"><span class="text-green-500 animate-pulse">â—</span> ONLINE: <span class="stat-val" id="liveUsers">0</span></div>
        <div class="stat-item"><span>ğŸ“±</span> CÄ°HAZ: <span class="stat-val" id="liveDevices">0</span></div>
        <div class="stat-item"><span>ğŸ‘¥</span> ÃœYE: <span class="stat-val" id="liveMembers">0</span></div>
    </div>

    <div id="loginOverlay" class="fixed inset-0 top-0 z-[10000] bg-black flex flex-col items-center justify-center p-8 transition-opacity duration-500">
        <div class="spider-container"><div class="spider-web"></div><div class="spider-logo">ğŸ•·ï¸</div></div>
        <div class="glitch-wrapper"><h1 class="glitch-text italic" style="font-family: 'Orbitron';">NPC SENSI</h1></div>
        <p class="text-white text-[10px] font-black tracking-[5px] mb-12 uppercase text-center text-red-500 animate-pulse">SYSTEM SECURITY: V4.0</p>
        <div class="w-full max-w-xs space-y-3">
            <input type="text" id="userInput" placeholder="KULLANICI ADI" class="bg-zinc-900 border-zinc-700">
            <input type="password" id="passInput" placeholder="ÅÄ°FRE" class="bg-zinc-900 border-zinc-700">
            <input type="text" id="inviteInput" placeholder="DAVET KODU" class="hidden border-red-600">
            <button id="authBtn" onclick="handleAuth()" class="w-full bg-red-600 py-4 rounded-2xl font-black text-white active:scale-95 transition shadow-[0_0_30px_rgba(255,0,0,0.6)]">GÄ°RÄ°Å YAP</button>
            <p id="toggleAuth" onclick="toggleAuthMode()" class="text-[11px] text-gray-400 mt-4 cursor-pointer uppercase text-center font-bold tracking-widest hover:text-white transition">HesabÄ±n yok mu? <span class="text-red-500 underline">KAYIT OL</span></p>
            <p onclick="resetPassword()" class="text-[10px] text-gray-500 mt-2 cursor-pointer hover:text-white text-center underline">Åifremi Unuttum?</p>
            <p id="authError" class="text-red-500 text-[11px] font-bold text-center mt-2"></p>
        </div>
    </div>

    <div id="mainNav" class="nav-bar hidden">
        <div onclick="navigate('platformPage'); playSound('click')" class="nav-icon active">ğŸ </div>
        <div onclick="navigate('gameHubPage'); playSound('click')" class="nav-icon text-orange-500">ğŸ®</div>
        <div onclick="navigate('aiPage'); playSound('click')" class="nav-icon text-green-400">ğŸ¤–</div>
        <div onclick="navigate('chatPage'); playSound('click')" class="nav-icon">ğŸ’¬</div>
        <div onclick="navigate('shopPage'); playSound('click')" class="nav-icon text-yellow-500">ğŸ›’</div>
        <div onclick="navigate('profilePage'); playSound('click')" class="nav-icon">ğŸ‘¤</div>
    </div>

    <div id="platformPage" class="page page-hidden">
        <div id="platformAdminBtn" onclick="openAdmin()" style="display:none;" class="absolute top-14 right-4 bg-red-600 text-white px-3 py-1 rounded-full font-black text-[10px] cursor-pointer hover:scale-110 transition z-50 shadow-lg border border-red-400">ADMIN âš™ï¸</div>
        <div class="max-w-md mx-auto pt-6 text-center">
            <h2 class="font-black text-4xl mb-6 italic text-red-600 uppercase tracking-tighter drop-shadow-[0_0_15px_rgba(255,0,0,0.6)]">KEÅFET</h2>
            <div class="px-4 mb-6 relative z-10">
                <div class="relative group">
                    <div class="absolute inset-0 bg-red-600 blur-lg opacity-20 group-hover:opacity-40 transition duration-500 rounded-2xl"></div>
                    <input type="text" id="searchInput" onkeyup="searchDevices()" placeholder="Cihaz, Marka veya Ayar..." 
                        class="relative w-full pl-12 pr-4 py-4 bg-zinc-900/90 border border-white/10 rounded-2xl focus:border-red-600 focus:shadow-[0_0_30px_rgba(255,0,0,0.3)] transition-all text-white font-bold placeholder-gray-500 text-sm">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xl animate-pulse">ğŸ”</span>
                </div>
                <div class="flex gap-2 mt-4 overflow-x-auto pb-2 hide-scrollbar">
                    <button onclick="filterSmart('all')" class="flex-shrink-0 bg-white/5 border border-white/10 hover:bg-red-600 hover:border-red-600 text-white px-4 py-2 rounded-xl text-[10px] font-black transition">TÃœMÃœ</button>
                    <button onclick="filterSmart('pro')" class="flex-shrink-0 bg-white/5 border border-white/10 hover:bg-purple-600 hover:border-purple-600 text-white px-4 py-2 rounded-xl text-[10px] font-black transition">ğŸ† PRO AYARLAR</button>
                    <button onclick="filterSmart('high')" class="flex-shrink-0 bg-white/5 border border-white/10 hover:bg-green-600 hover:border-green-600 text-white px-4 py-2 rounded-xl text-[10px] font-black transition">âš¡ YÃœKSEK HASSASÄ°YET</button>
                    <button onclick="filterSmart('popular')" class="flex-shrink-0 bg-white/5 border border-white/10 hover:bg-yellow-600 hover:border-yellow-600 text-white px-4 py-2 rounded-xl text-[10px] font-black transition">ğŸ”¥ POPÃœLER</button>
                </div>
            </div>
            <div class="px-4 mb-6"><p class="text-left text-[10px] font-bold text-gray-400 uppercase mb-2 ml-1">MARKALAR</p><div class="brand-scroller"><div class="brand-card" onclick="quickBrandFilter('XIAOMI')"><span class="brand-icon">ğŸ“±</span><span class="brand-name">XIAOMI</span></div><div class="brand-card" onclick="quickBrandFilter('SAMSUNG')"><span class="brand-icon">ğŸŒŒ</span><span class="brand-name">SAMSUNG</span></div><div class="brand-card" onclick="quickBrandFilter('APPLE')"><span class="brand-icon">ğŸ</span><span class="brand-name">APPLE</span></div><div class="brand-card" onclick="quickBrandFilter('HUAWEI')"><span class="brand-icon">ğŸ”´</span><span class="brand-name">HUAWEI</span></div><div class="brand-card" onclick="quickBrandFilter('PC')"><span class="brand-icon">ğŸ’»</span><span class="brand-name">EMULATOR</span></div></div></div>
            <div class="px-4"><p class="text-left text-[10px] font-bold text-gray-400 uppercase mb-2 ml-1">KATEGORÄ°LER</p><div id="platformGrid" class="grid grid-cols-2 gap-4"><div class="menu-card flex flex-col items-center justify-center h-32 hover:border-red-500" onclick="openCategory('ANDROID')"><span class="text-4xl mb-2">ğŸ¤–</span><span class="category-text">ANDROID</span></div><div class="menu-card flex flex-col items-center justify-center h-32 hover:border-red-500" onclick="openCategory('IOS')"><span class="text-4xl mb-2">ğŸ</span><span class="category-text">IOS</span></div><div class="menu-card flex flex-col items-center justify-center h-32 hover:border-red-500" onclick="openCategory('PC')"><span class="text-4xl mb-2">ğŸ’»</span><span class="category-text">PC</span></div><div class="menu-card flex flex-col items-center justify-center h-32 hover:border-red-500" onclick="openCategory('TABLET')"><span class="text-4xl mb-2">ğŸ“Ÿ</span><span class="category-text">TABLET</span></div></div></div>
            <div id="searchResultList" class="mt-6 space-y-3 hidden text-left pb-20 px-4"></div>
        </div>
    </div>

    <div id="gameHubPage" class="page page-hidden">
        <div class="max-w-md mx-auto pt-6 px-4 text-center">
            <h2 class="font-black text-3xl mb-8 italic text-orange-500 uppercase tracking-tighter drop-shadow-[0_0_15px_orange]">OYUN MERKEZÄ°</h2>
            <div class="game-hub-grid">
                <div class="game-hub-card border-orange-500/50" onclick="navigate('reflexPage'); playSound('click')"><span class="gh-icon">âš¡</span><span class="gh-title text-orange-400">REFLEX GOD</span><span class="gh-desc">HÄ±zÄ±nÄ± Test Et</span></div>
                <div class="game-hub-card border-blue-500/50" onclick="navigate('fastAimPage'); playSound('click')"><span class="gh-icon">ğŸ”«</span><span class="gh-title text-blue-400">FAST AIM</span><span class="gh-desc">30sn HÄ±z Testi</span></div>
                <div class="game-hub-card border-red-500/50" onclick="navigate('arenaPage'); playSound('click')"><span class="gh-icon">âš”ï¸</span><span class="gh-title text-red-400">ARENA VS</span><span class="gh-desc">1vs1 KapÄ±ÅŸma</span></div>
                <div class="game-hub-card border-blue-500/50" onclick="navigate('outfitPage'); playSound('click')"><span class="gh-icon">ğŸ‘•</span><span class="gh-title text-blue-400">FF KASA</span><span class="gh-desc">Kombin Tasarla</span></div>
                <div class="game-hub-card border-purple-500/50" onclick="navigate('squadPage'); playSound('click')"><span class="gh-icon">ğŸ´â€â˜ ï¸</span><span class="gh-title text-purple-400">SQUAD</span><span class="gh-desc">Ã‡eteni Kur</span></div>
                <div class="game-hub-card border-green-500/50" onclick="navigate('hudPage'); playSound('click')"><span class="gh-icon">ğŸ–¼ï¸</span><span class="gh-title text-green-400">HUD GALERÄ°</span><span class="gh-desc">AyarlarÄ±nÄ± PaylaÅŸ</span></div>
                
                <div class="game-hub-card border-yellow-500/50" onclick="navigate('roomPage'); playSound('click')"><span class="gh-icon">ğŸ›¡ï¸</span><span class="gh-title text-yellow-400">ODA DUVARI</span><span class="gh-desc">VS OdasÄ± Bul</span></div>
                <div class="game-hub-card border-pink-500/50" onclick="navigate('quizPage'); playSound('click')"><span class="gh-icon">ğŸ§ </span><span class="gh-title text-pink-400">FF BÄ°LGÄ°NÄ°</span><span class="gh-desc">SilahÄ± Tahmin Et</span></div>
            </div>
        </div>
    </div>

    <div id="roomPage" class="page page-hidden text-center">
        <div class="max-w-md mx-auto pt-4 px-4">
            <button onclick="navigate('gameHubPage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button>
            <div class="clear-both"></div>
            <h2 class="text-3xl font-black text-yellow-500 italic mb-2 uppercase">ODA DUVARI ğŸ›¡ï¸</h2>
            <p class="text-xs text-gray-400 mb-6">VS OdasÄ± Kurdun mu? Burada PaylaÅŸ!</p>
            
            <div class="bg-yellow-900/20 p-4 rounded-2xl border border-yellow-600/30 mb-6 text-left space-y-2">
                <input type="text" id="roomIdInput" placeholder="Oda ID" class="text-xs">
                <input type="text" id="roomPassInput" placeholder="Åifre" class="text-xs">
                <select id="roomModeInput" class="text-xs"><option>1 vs 1</option><option>2 vs 2</option><option>4 vs 4</option><option>SÄ±nÄ±rsÄ±z Cephane</option></select>
                <button onclick="shareRoom()" class="w-full bg-yellow-600 py-3 rounded-xl font-bold text-black text-xs hover:scale-105 transition">ODAYI PAYLAÅ (+20 P)</button>
            </div>
            
            <div id="roomList" class="space-y-3 pb-20"></div>
        </div>
    </div>

    <div id="quizPage" class="page page-hidden text-center">
        <div class="max-w-md mx-auto pt-4 px-4 h-full flex flex-col">
            <button onclick="navigate('gameHubPage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button>
            <h2 class="text-3xl font-black text-pink-500 italic mb-6 uppercase">FF BÄ°LGÄ°NÄ° ğŸ§ </h2>
            
            <div id="quizArea" class="flex-1 flex flex-col items-center justify-center">
                <div class="bg-black border-2 border-pink-500 rounded-2xl p-6 w-full max-w-xs relative overflow-hidden mb-4">
                    <div class="text-[10px] text-gray-400 absolute top-2 right-4">Skor: <span id="quizScore" class="text-pink-500 font-bold">0</span></div>
                    <img id="quizImg" src="" class="w-32 h-32 object-contain mx-auto mb-4 filter brightness-0 invert">
                    <p class="text-white font-bold text-sm mb-4">BU HANGÄ° SÄ°LAH/EÅYA?</p>
                    <div id="quizOptions" class="grid grid-cols-2 gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cardPage" class="page page-hidden text-center">
        <div class="max-w-md mx-auto pt-4 px-4">
            <button onclick="navigate('profilePage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button>
            <h2 class="text-3xl font-black text-blue-500 italic mb-6 uppercase">KÄ°MLÄ°K KARTI ğŸªª</h2>
            
            <div id="proCard" class="pro-card-preview mb-4">
                <img id="proCardBg" src="https://images.unsplash.com/photo-1542751371-adc38448a05e" class="pro-card-bg">
                <div class="relative z-10 flex flex-col h-full justify-between text-left">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-black text-2xl text-white italic uppercase tracking-tighter" id="cardName">...</h3>
                            <p class="text-[10px] text-yellow-400 font-bold bg-black/50 px-2 rounded inline-block" id="cardRole">RUSHER</p>
                        </div>
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="w-12 h-12 rounded-full border-2 border-white" id="cardAvatar">
                    </div>
                    <div class="grid grid-cols-3 gap-2 bg-black/60 p-2 rounded-xl backdrop-blur-sm border border-white/10">
                        <div class="text-center"><p class="text-[8px] text-gray-400">K/D</p><p class="font-black text-white text-sm" id="cardKD">0.00</p></div>
                        <div class="text-center"><p class="text-[8px] text-gray-400">HEADSHOT</p><p class="font-black text-white text-sm" id="cardHS">0%</p></div>
                        <div class="text-center"><p class="text-[8px] text-gray-400">LEVEL</p><p class="font-black text-white text-sm" id="cardLvl">1</p></div>
                    </div>
                </div>
            </div>

            <div class="bg-zinc-900 p-4 rounded-2xl space-y-3 border border-white/10">
                <div class="flex gap-2">
                    <input type="text" id="inpKD" placeholder="K/D OranÄ±" class="flex-1 text-xs">
                    <input type="text" id="inpHS" placeholder="HS OranÄ± %" class="flex-1 text-xs">
                </div>
                <select id="inpRole" class="text-xs bg-black text-white p-2 rounded w-full"><option>RUSHER</option><option>SNIPER</option><option>SUPPORT</option><option>IGL</option></select>
                <div class="upload-btn-area py-2" onclick="document.getElementById('cardBgInput').click()">ARKAPLAN RESMÄ° SEÃ‡ ğŸ“¸</div>
                <button onclick="updateCard()" class="w-full bg-blue-600 py-3 rounded-xl font-bold text-xs text-white">GÃœNCELLE</button>
            </div>
        </div>
    </div>

    <div id="hudPage" class="page page-hidden text-center">
        <div class="max-w-md mx-auto pt-4 px-4">
            <button onclick="navigate('gameHubPage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button>
            <div class="clear-both"></div>
            <h2 class="text-3xl font-black text-green-500 italic mb-2 uppercase">HUD GALERÄ°SÄ° ğŸ–¼ï¸</h2>
            <p class="text-xs text-gray-400 mb-6">En Ä°yi Parmak AyarlarÄ±nÄ± KeÅŸfet!</p>
            <div class="upload-btn-area" onclick="document.getElementById('hudInput').click()">
                <p class="text-2xl mb-2">ğŸ“¸</p><p>KENDÄ° HUD AYARINI YÃœKLEMEK Ä°Ã‡Ä°N TIKLA</p><p class="text-[8px] mt-1 text-gray-500">(Otomatik OnaylanÄ±r)</p>
            </div>
            <div id="hudGalleryGrid" class="hud-grid pb-20"><p class="text-gray-500 text-xs col-span-2">YÃ¼kleniyor...</p></div>
        </div>
    </div>

    <div id="shopPage" class="page page-hidden">
        <div class="max-w-md mx-auto pt-2 px-4 text-center">
            <h2 class="text-3xl font-black text-yellow-500 italic uppercase tracking-tighter mb-2">MAÄAZA</h2>
            <p class="text-xs text-gray-400 mb-6">Sola kaydÄ±rarak gez ğŸ›’</p>
            <div id="shopContainerNew" class="pb-20"></div>
        </div>
    </div>

    <div id="auctionPage" class="page page-hidden text-center">
        </div>

    <div id="squadPage" class="page page-hidden text-center">
        <div class="max-w-md mx-auto pt-4 px-4">
            <button onclick="navigate('gameHubPage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button>
            <div class="clear-both"></div>
            <h2 class="text-3xl font-black text-purple-600 italic mb-6 uppercase">Ã‡ETE ğŸ´â€â˜ ï¸</h2>
            <div id="noSquadPanel" class="bg-purple-900/20 p-6 rounded-2xl border border-purple-500/30">
                <p class="text-gray-300 text-xs mb-4">HenÃ¼z bir Ã§eten yok!</p>
                <input type="text" id="squadNameInput" placeholder="Ã‡ete AdÄ± (Max 6 Harf)" maxlength="6" class="uppercase">
                <button onclick="createSquad()" class="w-full bg-purple-600 py-3 rounded-xl font-bold text-white mb-2">Ã‡ETE KUR (5000 P)</button>
                <button onclick="joinSquad()" class="w-full bg-transparent border border-purple-500 py-3 rounded-xl font-bold text-purple-500">Ã‡ETEYE KATIL</button>
            </div>
            <div id="mySquadPanel" class="hidden">
                <h3 id="squadTitle" class="text-2xl font-black text-white mb-1">...</h3>
                <p class="text-xs text-purple-300 font-bold mb-4">Ã‡ETE PUANI: <span id="squadTotalPoints">0</span> ğŸ†</p>
                <button onclick="donateToSquad()" class="bg-green-600 text-white text-[10px] px-4 py-2 rounded-full font-bold mb-4 animate-pulse">ğŸ’° PUAN BAÄIÅLA</button>
                <div id="squadChat" class="h-64 overflow-y-auto bg-black/40 rounded-xl p-4 mb-2 text-left space-y-2 border border-purple-500/20"></div>
                <div class="flex gap-2"><input type="text" id="sqMsg" placeholder="Ã‡ete mesajÄ±..."><button onclick="sendSquadChat()" class="bg-purple-600 px-4 rounded-xl">â¤</button></div>
                <button onclick="leaveSquad()" class="text-red-500 text-[10px] mt-4 underline">Ã‡eteden AyrÄ±l</button>
            </div>
        </div>
    </div>

    <div id="arenaPage" class="page page-hidden text-center"><div class="max-w-md mx-auto pt-4 px-4"><button onclick="navigate('gameHubPage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button><div class="clear-both"></div><h2 class="text-3xl font-black text-red-600 italic mb-2 uppercase">ARENA âš”ï¸</h2><p class="text-xs text-gray-400 mb-6">1vs1 PuanÄ±na KapÄ±ÅŸ! (YazÄ± Tura)</p><div class="bg-red-900/20 p-4 rounded-2xl border border-red-600/30 mb-6"><input type="number" id="betAmount" placeholder="Bahis MiktarÄ± (Min 100)" class="mb-2"><button onclick="createDuel()" class="w-full bg-red-600 py-3 rounded-xl font-bold text-white animate-pulse">DÃœELLO OLUÅTUR ğŸ²</button></div><div id="activeDuels" class="pb-20"></div></div></div>
    <div id="aiPage" class="page page-hidden text-center"><div class="max-w-md mx-auto pt-4 px-4"><h2 class="text-3xl font-black text-green-500 italic mb-2 uppercase">AI SENSI ğŸ¤–</h2><p class="text-xs text-gray-400 mb-6">Yapay Zeka Sana Ã–zel Ayar YapsÄ±n</p><div class="bg-green-900/10 p-6 rounded-3xl border border-green-500/30 mb-6 space-y-3"><div class="relative"><input type="text" id="aiModelInput" placeholder="Cihaz Modelini Yaz (Ã–rn: Redmi Note 10 Pro)" class="w-full bg-black/50 text-white text-xs p-3 rounded-xl border border-green-500/30 font-bold uppercase focus:border-green-500 transition mb-2"></div><select id="aiStyle"><option>Rusher (YakÄ±n Mesafe)</option><option>Support (Destek)</option><option>Sniper (Uzak)</option><option>All Rounder (Dengeli)</option></select><div id="aiMatrix" class="ai-matrix">WAITING FOR INPUT...</div><button onclick="runAI()" class="w-full bg-green-600 py-3 rounded-xl font-bold text-black shadow-[0_0_15px_#0f0]">ANALÄ°Z ET & ÃœRET</button></div><div id="aiResult" class="hidden animate-fade-in bg-black p-4 rounded-xl border border-green-500"><h3 class="text-green-500 font-bold mb-4">Ã–NERÄ°LEN AYARLAR</h3><div class="grid grid-cols-2 gap-2 text-[10px] font-mono text-white text-left"><div>GENEL: <span id="aiGen" class="text-green-400">0</span></div><div>RED DOT: <span id="aiRed" class="text-green-400">0</span></div><div>2X: <span id="ai2x" class="text-green-400">0</span></div><div>4X: <span id="ai4x" class="text-green-400">0</span></div><div>DPI: <span id="aiDpi" class="text-green-400">0</span></div><div>ATEÅ: <span id="aiFire" class="text-green-400">0</span></div></div></div></div></div>
    <div id="outfitPage" class="page page-hidden"><div class="max-w-md mx-auto pt-2 px-4 text-center"><button onclick="navigate('gameHubPage')" class="text-2xl mb-4 hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button><div class="clear-both"></div><h2 class="text-3xl font-black text-blue-500 italic uppercase tracking-tighter mb-2">FF KASA</h2><div class="rarity-box"><p class="text-[9px] text-gray-400 uppercase">KOMBÄ°N GÃœCÃœ</p><p class="text-xl font-black text-white" id="rarityScore">%0 EFSANEVÄ°</p></div><div class="mannequin-container"><div id="manHead" class="man-head"></div><div id="manMask" class="man-mask"></div><div id="manBody" class="man-body"></div><div id="manLegs" class="man-legs"></div><div class="man-shoes"><div id="shoeL" class="shoe"></div><div id="shoeR" class="shoe"></div></div></div><div class="outfit-tabs"><button onclick="renderOutfitItems('head')" class="outfit-tab active">ÅAPKA/SAÃ‡</button><button onclick="renderOutfitItems('mask')" class="outfit-tab">MASKE</button><button onclick="renderOutfitItems('body')" class="outfit-tab">ÃœST</button><button onclick="renderOutfitItems('legs')" class="outfit-tab">ALT</button><button onclick="renderOutfitItems('shoes')" class="outfit-tab">AYAK</button></div><div id="outfitGrid" class="outfit-grid"></div><div class="flex gap-2 mt-4 pb-10"><button onclick="randomizeOutfit()" class="flex-1 bg-zinc-800 text-white py-3 rounded-xl font-bold text-xs">ğŸ² RASTGELE</button><button onclick="saveOutfit()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold text-xs shadow-[0_0_15px_blue]">ğŸ’¾ PROFÄ°LE EKLE</button></div></div></div>
    <div id="reflexPage" class="page page-hidden flex flex-col items-center justify-center text-center"><div class="w-full max-w-md px-4 absolute top-4 left-0"><button onclick="navigate('gameHubPage')" class="text-2xl hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button></div><h2 class="text-4xl font-black text-orange-500 italic uppercase tracking-tighter mb-2 glitch-text mt-10">REFLEX GOD</h2><p class="text-[10px] text-gray-400 mb-6 font-bold tracking-widest">HIZINI VE HEDEF ALMA YETENEÄÄ°NÄ° Ã–LÃ‡</p><div id="reflexArea" class="relative w-full max-w-xs h-72 bg-zinc-900/50 border-2 border-dashed border-orange-500/30 rounded-3xl overflow-hidden mb-6 cursor-crosshair shadow-[0_0_30px_rgba(255,165,0,0.1)] select-none"><div id="reflexStartScreen" class="absolute inset-0 flex flex-col items-center justify-center z-10 bg-black/90 space-y-3 p-4"><span class="text-4xl mb-2">ğŸ¯</span><p class="text-xs text-white mb-2 font-bold">MOD SEÃ‡:</p><button onclick="startReflexGame('easy')" class="w-full bg-green-600 text-white py-3 rounded-xl font-black text-xs hover:scale-105 transition shadow-[0_0_10px_green]">ğŸŸ¢ KOLAY (BÃ¼yÃ¼k Hedef)</button><button onclick="startReflexGame('hard')" class="w-full bg-orange-600 text-white py-3 rounded-xl font-black text-xs hover:scale-105 transition shadow-[0_0_10px_orange]">ğŸŸ  ZOR (KÃ¼Ã§Ã¼k Hedef)</button><button onclick="startReflexGame('impossible')" class="w-full bg-purple-600 text-white py-3 rounded-xl font-black text-xs hover:scale-105 transition shadow-[0_0_15px_purple] animate-pulse">ğŸ˜ˆ Ä°MKANSIZ (Pixel Aim)</button></div><div id="reflexWaitMsg" class="hidden absolute inset-0 flex items-center justify-center font-black text-2xl text-red-600 animate-pulse tracking-[5px] z-0">HAZIRLAN...</div><div id="reflexTarget" onmousedown="hitReflexTarget(event)" class="hidden absolute rounded-full border-2 border-white shadow-[0_0_20px_white] z-20 active:scale-90 flex items-center justify-center transition-transform duration-75"><div class="w-1 h-1 bg-white rounded-full"></div></div></div><div id="reflexResult" class="hidden bg-black/90 border border-orange-500 p-6 rounded-2xl w-full max-w-xs animate-fade-in relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-1 bg-orange-500"></div><p class="text-[10px] text-gray-400 font-bold uppercase mb-1">TEPKÄ° SÃœRESÄ°</p><h3 class="text-5xl font-black text-white mb-2 italic"><span id="reflexMs">0</span><span class="text-lg text-gray-500 not-italic">ms</span></h3><div id="reflexRankBox" class="bg-white/5 p-2 rounded mb-4 border border-white/10"><p id="reflexRank" class="text-sm font-black text-orange-400 tracking-widest">...</p></div><button onclick="resetReflexUI()" class="w-full bg-white text-black py-3 rounded-xl font-black text-xs hover:bg-gray-200">TEKRAR DENE â†»</button></div></div>
    <div id="fastAimPage" class="page page-hidden flex flex-col items-center justify-center text-center"><div class="w-full max-w-md px-4 absolute top-4 left-0"><button onclick="navigate('gameHubPage')" class="text-2xl hover:text-white transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button></div><h2 class="text-4xl font-black text-blue-500 italic uppercase tracking-tighter mb-2 glitch-text mt-10">FAST AIM</h2><p class="text-[10px] text-gray-400 mb-6 font-bold tracking-widest">30 SANÄ°YEDE KAÃ‡ HEDEF VURABÄ°LÄ°RSÄ°N?</p><div class="relative mb-4"><span class="text-2xl font-black text-white">SKOR: <span id="fastAimScore" class="text-blue-500">0</span></span><span class="ml-4 text-xs font-bold text-gray-500">SÃœRE: <span id="fastAimTime">30</span>sn</span></div><div id="fastAimArea" class="relative w-full max-w-xs h-80 bg-zinc-900/50 border-2 border-blue-500/30 rounded-3xl overflow-hidden mb-6 cursor-crosshair shadow-[0_0_30px_rgba(0,0,255,0.1)] select-none relative"><div id="fastAimStartBtn" class="absolute inset-0 flex items-center justify-center bg-black/80 z-20"><button onclick="startFastAimGame()" class="bg-blue-600 text-white px-8 py-4 rounded-2xl font-black text-xl hover:scale-110 transition shadow-[0_0_20px_blue] animate-pulse">BAÅLA ğŸ”«</button></div><div id="fastAimTarget" onmousedown="hitFastAim(event)" class="absolute w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full border-2 border-white shadow-[0_0_15px_white] hidden active:scale-50 transition-transform duration-75 z-10 flex items-center justify-center text-[10px]">ğŸ¯</div></div></div>
    <div id="chatPage" class="page page-hidden"><div class="max-w-md mx-auto pt-2 px-4 flex flex-col h-full"><h2 class="text-3xl font-black text-red-600 italic uppercase tracking-tighter text-center mb-4">GLOBAL CHAT</h2><div id="chatContainer" class="flex-1 overflow-y-auto mb-4 p-4 space-y-2 hide-scrollbar bg-black/40 rounded-3xl border border-white/10 backdrop-blur-md shadow-inner"><p class="text-center text-gray-400 text-xs py-10 font-bold">BaÄŸlanÄ±yor...</p></div><div class="flex gap-2"><input type="text" id="chatInput" placeholder="MesajÄ±nÄ± yaz..." class="flex-1 text-xs bg-zinc-800/80 border-zinc-700 rounded-xl text-white placeholder-gray-400"><button onclick="sendChatMessage()" class="bg-red-600 px-5 rounded-xl text-xl font-black text-white hover:scale-105 transition shadow-[0_0_15px_red]">â¤</button></div></div></div>
    <div id="homePage" class="page page-hidden"><div class="max-w-md mx-auto pt-2 px-4"><div class="flex items-center justify-between mb-6"><button onclick="navigate('platformPage')" class="text-2xl hover:text-red-600 transition bg-white/10 w-10 h-10 rounded-full flex items-center justify-center">ğŸ”™</button><h2 id="catTitle" class="text-2xl font-black text-red-600 italic uppercase tracking-tighter">LÄ°STE</h2><div class="w-10"></div></div><div class="mb-6 space-y-3"><select id="sortSelect" onchange="applyFilters()" class="text-xs bg-white/10 border-white/20 text-white font-bold"><option value="new">ğŸ“… En Yeniler</option><option value="popular">ğŸ”¥ En PopÃ¼ler</option><option value="az">ğŸ”¤ Ä°sim (A-Z)</option></select><div id="brandFilterContainer" class="filter-scroll"></div></div><div id="deviceGrid" class="space-y-4 pb-20"></div></div></div>
    <div id="detailPage" class="page page-hidden text-center"><div class="max-w-md mx-auto pt-2 px-4"><button onclick="navigate('homePage')" class="text-2xl mb-4 hover:text-red-600 transition float-left bg-white/10 w-10 h-10 rounded-full">ğŸ”™</button><div class="clear-both"></div><div id="detailContent" class="animate-fade-in"></div><div class="mt-6 bg-black/60 p-6 rounded-[35px] border border-red-600/30 shadow-[0_0_30px_rgba(255,0,0,0.1)] backdrop-blur-xl"><div class="flex justify-around items-center mb-6 border-b border-white/10 pb-6"><button onclick="handleVote('likes')" class="flex flex-col items-center group active:scale-90 transition"><span class="text-3xl mb-1 group-hover:scale-125 transition">ğŸ”¥</span><span id="likeCountDetail" class="font-black text-sm text-white/80">0</span></button><button onclick="handleVote('dislikes')" class="flex flex-col items-center group active:scale-90 transition"><span class="text-3xl mb-1 group-hover:scale-125 transition">ğŸ’©</span><span id="disCountDetail" class="font-black text-sm text-white/80">0</span></button></div><div id="commentBox" class="space-y-3 max-h-48 overflow-y-auto mb-4 pr-2 text-left"></div><div class="flex gap-2"><input type="text" id="cInp" placeholder="Yorum ekle..." class="flex-1 text-xs bg-white/5 border-white/10 text-white placeholder-gray-500"><button onclick="addComment()" class="bg-red-600 px-4 rounded-xl font-black text-[10px] text-white">AT</button></div></div></div></div>
    <div id="vsPage" class="page page-hidden text-center"><div class="max-w-md mx-auto pt-4 px-4"><h2 class="text-3xl font-black text-red-600 italic mb-6 uppercase">VS MODU</h2><div class="grid grid-cols-2 gap-2 mb-6"><select id="vsSelect1" onchange="renderVS()"><option value="">1. Cihaz</option></select><select id="vsSelect2" onchange="renderVS()"><option value="">2. Cihaz</option></select></div><div id="vsResult" class="grid grid-cols-2 gap-4 opacity-0 transition duration-500"></div></div></div>
    <div id="profilePage" class="page page-hidden p-0" style="padding:0; top:40px;"><div class="profile-header"><img src="https://images.unsplash.com/photo-1614850523459-c2f4c699c52e" class="profile-cover"><div class="profile-avatar-wrapper cursor-pointer" onclick="changeAvatar()"><img id="userAvatarImg" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="profile-img"></div></div><div class="relative z-10 px-6 flex flex-col items-center -mt-10"><h2 id="uNameDisplay" class="text-3xl font-black text-red-600 uppercase italic tracking-tighter mb-1">...</h2><div id="userRank" class="rank-tag rank-bronze mb-2 inline-block shadow-lg">...</div><div class="bio-box"><span id="userBio" class="bio-text">HenÃ¼z biyografi yok...</span><span onclick="editBio()" class="edit-bio-btn">âœ DÃœZENLE</span></div><div class="mt-4"><button onclick="navigate('cardPage')" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-black text-xs shadow-lg animate-pulse hover:scale-105 transition">ğŸªª KÄ°MLÄ°K KARTI OLUÅTUR</button></div><div class="flex flex-wrap justify-center gap-3 mt-4 mb-6 w-full px-6"><button onclick="openCountrySelector()" class="flex-1 bg-zinc-900 border border-white/10 p-2 rounded-xl hover:border-red-600 transition flex flex-col items-center gap-1"><span class="text-[9px] text-gray-500 font-bold uppercase">ÃœLKE</span><span id="flagDisplay" class="text-2xl">ğŸŒ</span></button><button onclick="openWeaponSelector()" class="flex-[2] bg-zinc-900 border border-white/10 p-2 rounded-xl hover:border-blue-500 transition flex flex-col items-center gap-1 group"><span class="text-[9px] text-gray-500 font-bold uppercase group-hover:text-blue-400">FAVORÄ° SÄ°LAHLAR</span><span id="favWeaponsDisplay" class="text-[10px] font-mono text-blue-300 tracking-tighter">HenÃ¼z seÃ§ilmedi...</span></button></div><div class="profile-tabs"><button class="p-tab-btn active" onclick="switchProfileTab('info')">BÄ°LGÄ°LER</button><button class="p-tab-btn" onclick="switchProfileTab('leaderboard')">SIRALAMA</button></div><div id="tab-info" class="w-full flex flex-col items-center"><button id="dailyRewardBtn" onclick="openRoulette()" class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-black px-6 py-3 rounded-full font-black text-sm mb-4 shadow-[0_0_15px_gold] hover:scale-105 transition animate-bounce">ğŸ° RULET Ã‡EVÄ°R</button><div class="xp-wrapper"><div class="xp-header"><span>SEVÄ°YE <span id="lvlNum">1</span></span><span id="xpText">0/100 XP</span></div><div class="xp-track"><div id="xpFill" class="xp-fill"></div></div></div><div class="grid grid-cols-3 gap-3 w-full max-w-xs mb-6"><div class="bg-zinc-900/50 p-3 rounded-2xl text-center border border-white/5"><p class="text-lg font-black text-white" id="followingCount">0</p><p class="text-[8px] text-gray-400 uppercase">Takip</p></div><div class="bg-zinc-900/50 p-3 rounded-2xl text-center border border-white/5"><p class="text-lg font-black text-white" id="followerCount">0</p><p class="text-[8px] text-gray-400 uppercase">TakipÃ§i</p></div><div class="bg-zinc-900/50 p-3 rounded-2xl text-center border border-white/5"><p class="text-lg font-black text-red-500" id="userStats">0</p><p class="text-[8px] text-gray-400 uppercase">Puan</p></div></div><div class="w-full max-w-xs mb-10"><p class="text-left text-[10px] font-bold text-gray-400 uppercase mb-3 ml-1">GÃ–REVLER & BAÅARIMLAR</p><div id="achievementList"></div></div><button onclick="handleLogout()" class="w-full max-w-xs bg-red-900/50 text-red-200 py-3 rounded-xl font-bold text-[10px] mb-10">Ã‡IKIÅ YAP</button></div><div id="tab-leaderboard" class="w-full hidden pb-20"><div id="leaderList" class="space-y-3 w-full max-w-md mx-auto"><p class="text-gray-400 text-xs font-bold">YÃ¼kleniyor...</p></div></div></div></div>

    <div id="adminModal" class="admin-modal">
        <div class="bg-zinc-900 p-8 rounded-[40px] border border-red-600 w-full max-w-md space-y-6 overflow-y-auto max-h-[90vh] relative shadow-[0_0_50px_rgba(255,0,0,0.2)]">
            <button onclick="document.getElementById('adminModal').style.display='none'" class="absolute top-6 right-6 text-2xl hover:text-red-600">âœ•</button>
            <h2 class="neon-red font-black text-center uppercase italic text-2xl tracking-tighter mb-6">AI CONTROL</h2>
            <p class="text-center text-xs text-gray-400 mb-4">Aktif Davet Kodu: <span id="currentInviteDisplay" class="text-white font-bold">...</span></p>
            
            <div class="border-b border-white/10 pb-4">
                <p class="text-[10px] text-green-400 font-black uppercase mb-2">KASA ÃœRÃœNÃœ EKLE</p>
                <input type="text" id="vaultTitle" placeholder="ÃœrÃ¼n BaÅŸlÄ±ÄŸÄ±" class="bg-black text-white text-xs p-2 rounded w-full mb-1">
                <input type="text" id="vaultDesc" placeholder="AÃ§Ä±klama" class="bg-black text-white text-xs p-2 rounded w-full mb-1">
                <input type="number" id="vaultPrice" placeholder="Fiyat (Puan)" class="bg-black text-white text-xs p-2 rounded w-full mb-1">
                <div class="upload-btn-area py-2 mb-2" onclick="document.getElementById('vaultImgInput').click()">RESÄ°M SEÃ‡</div>
                <input type="text" id="vaultSecret" placeholder="Gizli Ä°Ã§erik (Link/Metin)" class="bg-black text-white text-xs p-2 rounded w-full mb-2">
                <button onclick="addVaultItemAdmin()" class="w-full bg-green-600 py-2 rounded text-xs font-bold">KASAYA EKLE</button>
            </div>

            <div class="border-b border-white/10 pb-4 pt-4">
                <p class="text-[10px] text-yellow-400 font-black uppercase mb-2">Ä°HALE BAÅLAT</p>
                <input type="text" id="aucItem" placeholder="ÃœrÃ¼n AdÄ±" class="bg-black text-white text-xs p-2 rounded w-full mb-1">
                <input type="number" id="aucStart" placeholder="BaÅŸlangÄ±Ã§ FiyatÄ±" class="bg-black text-white text-xs p-2 rounded w-full mb-1">
                <button onclick="startAuctionAdmin()" class="w-full bg-yellow-600 py-2 rounded text-xs font-bold">Ä°HALEYÄ° BAÅLAT</button>
            </div>

            <button onclick="clearChat()" class="w-full bg-red-800 text-white py-3 rounded-xl font-bold text-xs mb-4 mt-4">ğŸ—‘ï¸ SOHBETÄ° TEMÄ°ZLE</button>
            <div class="bg-red-900/20 p-4 rounded-2xl border border-red-600/50 mb-4 shadow-[0_0_15px_red]"><p class="text-[10px] text-red-400 font-black uppercase mb-2">â›” BAN YÃ–NETÄ°MÄ°</p><input type="text" id="banInput" placeholder="KullanÄ±cÄ± UID YapÄ±ÅŸtÄ±r" class="bg-black/50 text-white text-xs p-3 rounded-xl w-full mb-2 border border-red-500/30 font-mono text-center"><div class="flex gap-2"><button onclick="banUser()" class="flex-1 bg-gradient-to-r from-red-600 to-red-800 text-white py-2 rounded-xl font-bold text-[10px] hover:scale-105 transition">BANLA ğŸ”¨</button><button onclick="unbanUser()" class="flex-1 bg-gradient-to-r from-green-600 to-green-800 text-white py-2 rounded-xl font-bold text-[10px] hover:scale-105 transition">KALDIR ğŸ˜‡</button></div></div>
            <div class="mb-4 pb-4 border-b border-white/10"><input type="text" id="announceInput" placeholder="Kayan YazÄ±"><button onclick="updateMarquee()" class="w-full bg-blue-600 py-2 rounded-xl font-bold text-xs text-white mt-2">GÃœNCELLE</button></div>
            <div class="space-y-3 pt-4 border-t border-white/10"><input type="text" id="adName" placeholder="Cihaz AdÄ±"><select id="adCat"><option value="ANDROID">ANDROID</option><option value="IOS">IOS</option><option value="PC">PC</option><option value="TABLET">TABLET</option></select><div class="upload-btn-area py-2" onclick="document.getElementById('adImgInput').click()">RESÄ°M SEÃ‡</div><input type="text" id="adVid" placeholder="Video URL"><div class="grid grid-cols-2 gap-2 text-[9px] font-bold"><div>Gen: <input type="number" id="vGen" value="100"></div><div>Red: <input type="number" id="vRed" value="100"></div><div>2X: <input type="number" id="vX2" value="100"></div><div>4X: <input type="number" id="vX4" value="100"></div></div><div>AteÅŸ: <input type="number" id="vFire" value="40"></div><button onclick="adminAddDevice()" class="w-full bg-white text-black py-4 rounded-xl font-black text-[11px]">EKLE</button></div>
        </div>
    </div>

    <div id="customPromptModal" class="fixed inset-0 z-[60000] bg-black/90 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-zinc-900 border border-red-600 p-6 rounded-2xl w-full max-w-sm shadow-[0_0_50px_rgba(255,0,0,0.3)] transform scale-95 transition-all">
            <h3 id="modalTitle" class="text-xl font-black text-white italic uppercase mb-4 text-center">BAÅLIK</h3>
            <input type="text" id="modalInput" class="w-full bg-black border border-zinc-700 text-white p-3 rounded-xl mb-4 focus:border-red-600 outline-none text-center font-bold" autocomplete="off">
            <div class="flex gap-2">
                <button onclick="closeCustomPrompt()" class="flex-1 py-3 bg-zinc-800 text-gray-400 rounded-xl font-bold text-xs hover:bg-zinc-700">Ä°PTAL</button>
                <button id="modalConfirmBtn" class="flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-xs shadow-[0_0_15px_red] hover:scale-105 transition">KAYDET</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA-iQ4vuDEYDyKO0GKEv7YktpaY1dF8wxk",
            authDomain: "npc-sensi.firebaseapp.com",
            databaseURL: "https://npc-sensi-default-rtdb.firebaseio.com",
            projectId: "npc-sensi",
            storageBucket: "npc-sensi.firebasestorage.app",
            messagingSenderId: "1023809046638",
            appId: "1:1023809046638:web:2a9db49b82673439d4be7f",
            measurementId: "G-GL3M87QRRW"
        };

        try { firebase.initializeApp(firebaseConfig); } catch(e) { console.error(e); }

        const db = firebase.database();
        const auth = firebase.auth();

        const REAL_ADMIN_UID = "EHt3BX5TvaXTYn4QsOQJWsOQI1C3"; 
        const IMGBB_API_KEY = "44cc68988859cbc4aeddb3e1eca2e405"; 

        window.devices = [];
        window.interactions = {};
        window.currentUserData = null;
        window.systemInviteCode = "NPC2026"; 
        let filteredList = [];
        let currentFilterBrand = "TÃœMÃœ";
        let currentCat = "ANDROID";
        window.currentAchTab = 'easy';
        
        let tempAdImgUrl = "";
        let tempVaultImgUrl = "";

        // --- GELÄ°ÅMÄ°Å RESÄ°M YÃœKLEME ---
        window.uploadImage = async (fileInputId) => {
            const input = document.getElementById(fileInputId);
            const file = input.files[0];
            if (!file) { alert("Resim seÃ§ilmedi!"); return null; }
            if (file.size > 10 * 1024 * 1024) { alert("Resim Ã§ok bÃ¼yÃ¼k (Max 10MB)!"); return null; }
            showToast("Sunucuya yÃ¼kleniyor... â³");
            const formData = new FormData(); formData.append("image", file);
            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                const data = await response.json();
                if (data.success) { showToast("YÃ¼klendi! âœ…"); return data.data.url; } 
                else { alert("Hata: " + (data.error?.message || "Bilinmiyor")); return null; }
            } catch (error) { alert("BaÄŸlantÄ± HatasÄ±!"); return null; }
        };
        
        window.changeAvatar = () => document.getElementById('avatarInput').click();
        window.handleAvatarUpload = async () => { const url = await uploadImage('avatarInput'); if (url) db.ref(`users/${auth.currentUser.uid}/avatar`).set(url); };
        window.handleHudUpload = async () => { const url = await uploadImage('hudInput'); if (url) { db.ref('public_data_v1/huds').push({ user: window.currentUserData.username, uid: auth.currentUser.uid, img: url, likes: 0 }); showToast("HUD PaylaÅŸÄ±ldÄ±!"); addPointsSecure(20, "HUD PaylaÅŸÄ±mÄ±"); } };
        window.handleCardBgUpload = async () => { const url = await uploadImage('cardBgInput'); if (url) document.getElementById('proCardBg').src = url; };
        window.handleAdImgUpload = async () => { tempAdImgUrl = await uploadImage('adImgInput'); };
        window.handleVaultImgUpload = async () => { tempVaultImgUrl = await uploadImage('vaultImgInput'); };

        // --- ODA DUVARI ---
        window.shareRoom = () => {
            const id = document.getElementById('roomIdInput').value;
            const pass = document.getElementById('roomPassInput').value;
            const mode = document.getElementById('roomModeInput').value;
            if(!id) return showToast("Oda ID gir!");
            db.ref('public_data_v1/rooms').push({
                id: id, pass: pass || "Yok", mode: mode, creator: window.currentUserData.username,
                time: Date.now()
            });
            showToast("Oda PaylaÅŸÄ±ldÄ±! ğŸ›¡ï¸");
            addPointsSecure(20, "Oda PaylaÅŸÄ±mÄ±");
            document.getElementById('roomIdInput').value = "";
        };
        
        // --- QUIZ GAME ---
        const quizData = [
            {img:"https://i.ibb.co/5xb1y2k/mp40.png", a:"MP40", opts:["MP40","UMP","THOMPSON","VECTOR"]},
            {img:"https://i.ibb.co/K2z5x9L/m1887.png", a:"M1887", opts:["SPAS12","M1014","M1887","MAG-7"]},
            {img:"https://i.ibb.co/Bn0y3zM/ak47.png", a:"AK47", opts:["SCAR","M4A1","AK47","GROZA"]},
            {img:"https://i.ibb.co/30y9z1K/awm.png", a:"AWM", opts:["KAR98K","AWM","M82B","M24"]}
        ];
        let currentQuiz = null;
        window.startQuiz = () => {
            currentQuiz = quizData[Math.floor(Math.random() * quizData.length)];
            document.getElementById('quizImg').src = currentQuiz.img;
            document.getElementById('quizOptions').innerHTML = currentQuiz.opts.map(o => `<button onclick="checkQuiz('${o}')" class="bg-pink-900/50 border border-pink-500 text-white text-xs py-2 rounded hover:bg-pink-600">${o}</button>`).join('');
        };
        window.checkQuiz = (ans) => {
            if(ans === currentQuiz.a) { showToast("DOÄRU! ğŸ‰"); addPointsSecure(10, "Quiz DoÄŸru Cevap"); startQuiz(); document.getElementById('quizScore').innerText = parseInt(document.getElementById('quizScore').innerText)+10; }
            else { showToast("YANLIÅ! âŒ"); playSound('error'); }
        };

        // --- SQUAD WARS ---
        window.donateToSquad = () => {
            const u = window.currentUserData;
            if(!u.squad) return showToast("Ã‡eten yok!");
            openCustomPrompt("BAÄIÅ MÄ°KTARI", "100", (val) => {
                const amt = parseInt(val);
                if(amt > 0 && u.points >= amt) {
                    addPointsSecure(-amt, "Ã‡ete BaÄŸÄ±ÅŸÄ±");
                    db.ref(`public_data_v1/squads/${u.squad}/points`).transaction(p => (p||0) + amt);
                    showToast("BaÄŸÄ±ÅŸ YapÄ±ldÄ±!");
                } else showToast("Yetersiz Puan!");
            });
        };

        // --- PRO KART ---
        window.updateCard = () => {
            const u = window.currentUserData;
            document.getElementById('cardName').innerText = u.username;
            document.getElementById('cardAvatar').src = u.avatar || "https://cdn-icons-png.flaticon.com/512/847/847969.png";
            document.getElementById('cardKD').innerText = document.getElementById('inpKD').value || "0.00";
            document.getElementById('cardHS').innerText = (document.getElementById('inpHS').value || "0") + "%";
            document.getElementById('cardRole').innerText = document.getElementById('inpRole').value;
            document.getElementById('cardLvl').innerText = Math.floor((u.points||0)/100)+1;
            showToast("Kart GÃ¼ncellendi!");
        };

        // --- Ä°HALE ---
        window.startAuctionAdmin = () => {
            const item = document.getElementById('aucItem').value;
            const start = parseInt(document.getElementById('aucStart').value);
            if(item && start) db.ref('public_data_v1/auction').set({item, bid:start, bidder:"Yok", end: Date.now() + 300000}); // 5 dk
        };
        window.bidAuction = () => {
            db.ref('public_data_v1/auction').once('value', s => {
                const a = s.val();
                if(!a) return;
                if(window.currentUserData.points > a.bid + 50) {
                    db.ref('public_data_v1/auction').update({bid: a.bid + 50, bidder: window.currentUserData.username});
                    addPointsSecure(-50, "Ä°hale Teklifi (Depozito)"); 
                    showToast("Teklif Verildi!");
                } else showToast("Yetersiz Puan veya Teklif DÃ¼ÅŸÃ¼k!");
            });
        };

        // --- TEMEL FONKSÄ°YONLAR ---
        window.addVaultItemAdmin = () => {
            const title = document.getElementById('vaultTitle').value;
            const desc = document.getElementById('vaultDesc').value;
            const price = parseInt(document.getElementById('vaultPrice').value);
            const secret = document.getElementById('vaultSecret').value;
            if(!title || !secret) return;
            db.ref('public_data_v1/vault_items').push({title, desc, price, img: tempVaultImgUrl, secret});
            showToast("Kasaya Eklendi!"); tempVaultImgUrl="";
        };

        window.renderVault = () => {
            db.ref('public_data_v1/vault_items').once('value', s => {
                const items = []; s.forEach(x => items.push({key:x.key, ...x.val()}));
                const u = window.currentUserData;
                const html = items.map(i => {
                    const isOwned = u.inventory?.vault?.[i.key];
                    return `<div class="vault-card ${isOwned ? 'vault-unlocked' : 'vault-locked'}"><img src="${i.img || 'https://via.placeholder.com/100'}" class="vault-img"><div class="text-left flex-1"><h4 class="font-black text-white text-xs uppercase">${i.title}</h4><p class="text-[9px] text-gray-400">${isOwned ? i.secret : i.desc}</p>${isOwned ? `<button class="mt-2 bg-green-600 text-white text-[9px] px-3 py-1 rounded font-bold" onclick="window.open('${i.secret}', '_blank')">AÃ‡ / GÄ°T</button>` : `<button onclick="buyVaultItem('${i.key}', ${i.price})" class="mt-2 bg-red-600 text-white text-[9px] px-3 py-1 rounded font-bold">AÃ‡ (${i.price} P)</button>`}</div></div>`;
                }).join('') || '<p class="text-xs text-gray-500">Kasa ÅŸu an boÅŸ...</p>';
                document.getElementById('vaultContainer').innerHTML = html;
            });
        };

        window.buyVaultItem = (key, price) => {
            const u = window.currentUserData;
            if(u.points < price) return showToast("Yetersiz Puan!");
            if(confirm(`${price} Puan Ã¶deyip kilidi aÃ§?`)) {
                addPointsSecure(-price, "Kasa AlÄ±ÅŸveriÅŸi");
                db.ref(`users/${auth.currentUser.uid}/inventory/vault/${key}`).set(true);
                showToast("Kilit AÃ§Ä±ldÄ±! ğŸ”“");
                renderShopNew();
            }
        };

        window.renderHUDs = () => {
            db.ref('public_data_v1/huds').limitToLast(20).on('value', s => {
                const list = []; s.forEach(x => list.push(x.val())); list.reverse();
                document.getElementById('hudGalleryGrid').innerHTML = list.map(h => `<div class="hud-card"><img src="${h.img}" class="hud-img" onclick="window.open('${h.img}','_blank')"><div class="p-2 flex justify-between items-center bg-black/50"><span class="text-[9px] font-bold text-white">${h.user}</span><span class="text-[9px] text-green-400">ğŸ”¥ ${h.likes||0}</span></div></div>`).join('');
            });
        };

        let activePromptCallback = null;
        function openCustomPrompt(title, defaultValue, callback) {
            const modal = document.getElementById('customPromptModal');
            const input = document.getElementById('modalInput');
            const titleEl = document.getElementById('modalTitle');
            titleEl.innerText = title;
            input.value = defaultValue || "";
            activePromptCallback = callback;
            modal.classList.remove('hidden'); modal.classList.add('flex');
            setTimeout(() => input.focus(), 100);
            input.onkeydown = (e) => { if(e.key === 'Enter') confirmCustomPrompt(); }
        }
        function closeCustomPrompt() { const modal = document.getElementById('customPromptModal'); modal.classList.add('hidden'); modal.classList.remove('flex'); activePromptCallback = null; }
        function confirmCustomPrompt() { const val = document.getElementById('modalInput').value.trim(); if (activePromptCallback) activePromptCallback(val); closeCustomPrompt(); playSound('click'); }
        document.getElementById('modalConfirmBtn').onclick = confirmCustomPrompt;

        window.addPointsSecure = (amount, reason) => {
            const u = auth.currentUser;
            if(!u || !window.currentUserData) return;
            if (amount > 100000) return;
            const currentPoints = window.currentUserData.points || 0;
            const newPoints = currentPoints + amount;
            db.ref(`users/${u.uid}/points`).set(newPoints);
            showToast(`+${amount} Puan (${reason})`);
            playSound('success');
        };

        window.handleVote = (type) => {
            if(!window.currentUserData) return showToast("GiriÅŸ yapmalÄ±sÄ±n!");
            if(!window.activeId) return;
            const uid = auth.currentUser.uid;
            const ref = db.ref(`public_data_v1/interactions/${window.activeId}/${type}/${uid}`);
            ref.once('value', (snapshot) => {
                if (snapshot.exists()) {
                    ref.remove(); showToast(type === 'likes' ? "Geri AlÄ±ndÄ±" : "Geri AlÄ±ndÄ±"); playSound('click');
                } else {
                    ref.set(true);
                    const opposite = type === 'likes' ? 'dislikes' : 'likes';
                    db.ref(`public_data_v1/interactions/${window.activeId}/${opposite}/${uid}`).remove();
                    showToast(type === 'likes' ? "ğŸ”¥ BeÄŸendin!" : "ğŸ’© BeÄŸenmedin!");
                    addPointsSecure(2, "EtkileÅŸim"); playSound('success');
                }
            });
        };

        window.addComment = () => { const m = document.getElementById('cInp').value; if(!m) return; db.ref(`public_data_v1/interactions/${window.activeId}/comments`).push({user:window.currentUserData.username, msg:m}); addPointsSecure(5, "Yorum Yapma"); document.getElementById('cInp').value = ""; };
        window.banUser = () => { const targetUid = document.getElementById('banInput').value.trim(); if(!targetUid) return showToast("UID Gir!"); if(targetUid === REAL_ADMIN_UID) return; db.ref(`users/${targetUid}/banned`).set(true); showToast("BanlandÄ±! ğŸ”¨"); };
        window.unbanUser = () => { const targetUid = document.getElementById('banInput').value.trim(); if(!targetUid) return; db.ref(`users/${targetUid}/banned`).set(null); showToast("Af Ã‡Ä±ktÄ±! âœ…"); };
        window.createSquad = () => { const u = window.currentUserData; if(!u) return; const name = document.getElementById('squadNameInput').value.trim().toUpperCase(); if(!name || name.length > 6) return showToast("GeÃ§ersiz isim!"); if(u.points < 5000) return showToast("5000 PuanÄ±n Yok!"); db.ref('public_data_v1/squads/' + name).once('value', s => { if(s.exists()) return showToast("Bu isim alÄ±nmÄ±ÅŸ!"); if(confirm("5000 Puan karÅŸÄ±lÄ±ÄŸÄ± Ã§ete kurulsun mu?")) { addPointsSecure(-5000, "Ã‡ete Kurulum"); const squadData = { leader: auth.currentUser.uid, name: name, points: 0, members: { [auth.currentUser.uid]: true } }; db.ref('public_data_v1/squads/' + name).set(squadData); db.ref(`users/${auth.currentUser.uid}/squad`).set(name); showToast("Ã‡ete Kuruldu! ğŸ´â€â˜ ï¸"); } }); };
        window.joinSquad = () => { const name = document.getElementById('squadNameInput').value.trim().toUpperCase(); if(!name) return showToast("Ä°sim gir!"); db.ref('public_data_v1/squads/' + name).once('value', s => { if(!s.exists()) return showToast("Ã‡ete bulunamadÄ±!"); db.ref(`users/${auth.currentUser.uid}/squad`).set(name); db.ref(`public_data_v1/squads/${name}/members/${auth.currentUser.uid}`).set(true); showToast("KatÄ±ldÄ±n! ğŸ”¥"); }); };
        window.leaveSquad = () => { if(!confirm("AyrÄ±lmak istiyor musun?")) return; const sq = window.currentUserData.squad; if(sq) { db.ref(`users/${auth.currentUser.uid}/squad`).set(null); db.ref(`public_data_v1/squads/${sq}/members/${auth.currentUser.uid}`).set(null); showToast("AyrÄ±ldÄ±n."); } };
        window.sendSquadChat = () => { const msg = document.getElementById('sqMsg').value; const sq = window.currentUserData.squad; if(!msg || !sq) return; db.ref(`public_data_v1/squads/${sq}/chat`).push({user: window.currentUserData.username, text: msg}); document.getElementById('sqMsg').value = ""; };
        window.createDuel = () => { const amt = parseInt(document.getElementById('betAmount').value); if(!amt || amt < 100) return showToast("Min 100 Puan!"); if(window.currentUserData.points < amt) return showToast("Yetersiz Puan!"); addPointsSecure(-amt, "DÃ¼ello Bahsi"); const bet = { creator: window.currentUserData.username, uid: auth.currentUser.uid, amount: amt, status: 'waiting' }; db.ref('public_data_v1/duels').push(bet); showToast("DÃ¼ello OluÅŸturuldu!"); };
        function getDeviceSeed(text) { let hash = 0; if (text.length === 0) return hash; for (let i = 0; i < text.length; i++) { let char = text.charCodeAt(i); hash = ((hash << 5) - hash) + char; hash = hash & hash; } return Math.abs(hash); }
        function seededRandom(seed) { var x = Math.sin(seed++) * 10000; return x - Math.floor(x); }
        window.runAI = () => { const modelInput = document.getElementById('aiModelInput').value.trim(); if(!modelInput) return showToast("Cihaz modelini yaz! ğŸ¤–"); const modelName = modelInput.toUpperCase(); document.getElementById('aiMatrix').style.display = 'block'; document.getElementById('aiMatrix').innerHTML = `ANALYZING ${modelName}...<br>KERNEL: ${getDeviceSeed(modelName)}...`; playSound('spin'); setTimeout(() => { document.getElementById('aiMatrix').style.display = 'none'; document.getElementById('aiResult').classList.remove('hidden'); let seed = getDeviceSeed(modelName); const gen = Math.floor(seededRandom(seed) * (100 - 88) + 88); const red = Math.floor(seededRandom(seed + 1) * (100 - 85) + 85); const x2 = Math.floor(seededRandom(seed + 2) * (100 - 90) + 90); const x4 = Math.floor(seededRandom(seed + 3) * (100 - 80) + 80); let dpi = modelName.includes("IPHONE") ? "GEREKMEZ" : Math.floor(seededRandom(seed + 4) * (900 - 500) + 500); const fire = Math.floor(seededRandom(seed + 5) * (60 - 35) + 35); document.getElementById('aiGen').innerText = gen; document.getElementById('aiRed').innerText = red; document.getElementById('ai2x').innerText = x2; document.getElementById('ai4x').innerText = x4; document.getElementById('aiDpi').innerText = dpi; document.getElementById('aiFire').innerText = fire + "%"; showToast(`AI: ${modelName} optimize edildi! ğŸ§¬`); playSound('success'); }, 2500); };
        window.getProSettings = (cat) => { if(cat === 'IOS' || cat === 'APPLE') return [{l:"Ä°mleÃ§", v:"120"}, {l:"DÃ¶ngÃ¼", v:"10"}]; if(cat === 'PC') return [{l:"DPI", v:"1000"}, {l:"X/Y", v:"1.00/0.60"}]; return [{l:"DPI", v:"500+"}, {l:"HÄ±z", v:"FULL"}]; };
        const outfitData = { head: [{id:'sakura', name:'SAKURA', col:'#ffcccc', icon:'ğŸŒ¸'}, {id:'hiphop', name:'HIP HOP', col:'#222', icon:'ğŸ§¢'}, {id:'angel', name:'MELEK', col:'#fff', icon:'ğŸ‘¼'}, {id:'bunny', name:'TAVÅAN', col:'#00ccff', icon:'ğŸ°'}], mask: [{id:'clown', name:'PALYAÃ‡O', icon:'ğŸ¤¡'}, {id:'skull', name:'KURUKAFA', icon:'ğŸ’€'}, {id:'bandit', name:'HAYDUT', icon:'ğŸ˜·'}], body: [{id:'sakura_top', name:'SAKURA', col:'#ffb7b2'}, {id:'hiphop_top', name:'HIP HOP', col:'#333'}, {id:'jersey', name:'FORMA', col:'#0000ff'}], legs: [{id:'angelic_m', name:'ANGELIC', col:'linear-gradient(90deg, #000 30%, #0000ff 30%, #0000ff 40%, #000 40%)'}, {id:'jazz', name:'CAZ', col:'#000'}], shoes: [{id:'jordan', name:'JORDAN', col:'#fff'}, {id:'flipflop', name:'TERLÄ°K', col:'#aa5500'}] };
        let currentOutfit = { head: null, mask: null, body: null, legs: null, shoes: null };
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        window.playSound = (type) => { if(audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); if(type === 'click') { osc.frequency.setValueAtTime(800, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime+0.1); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+0.1); osc.start(); osc.stop(audioCtx.currentTime+0.1); } else if(type === 'success') { osc.type = 'triangle'; osc.frequency.setValueAtTime(400, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime+0.1); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime+0.3); } else if(type === 'spin') { osc.type = 'square'; osc.frequency.setValueAtTime(100, audioCtx.currentTime); gain.gain.setValueAtTime(0.05, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime+0.05); } else if(type === 'error') { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime+0.2); } };
        const achievements = [{ id: 'e1', title: 'Ä°LK ADIM', desc: 'GiriÅŸ yap', reward: 50 }, { id: 'e2', title: 'STÄ°LÄ°ST', desc: 'Kombin sayfasÄ±na bak', reward: 50 }, { id: 'e3', title: 'MERAKLI', desc: 'Bir cihaza tÄ±kla', reward: 50 }, { id: 'm1', title: 'KOLEKSÄ°YONER', desc: 'MaÄŸazadan Ã¼rÃ¼n al', reward: 200 }, { id: 'm2', title: 'HIZLI', desc: 'Reflex < 400ms', reward: 200 }, { id: 'h1', title: 'MÄ°LYONER', desc: '10.000 Puan', reward: 1000 }, { id: 'h2', title: 'GODLIKE', desc: 'Reflex < 200ms', reward: 1000 }, { id: 'i1', title: 'INFINITY', desc: '100.000 Puan', reward: 10000 }];

        window.renderAchievements = () => { const u = window.currentUserData; if(!u) return; const claimed = u.achievements || {}; const tabsHTML = `<div class="h-category-tabs"><button onclick="setAchTab('easy')" class="h-tab-btn ${currentAchTab==='easy'?'active':''}">ğŸŸ¢ KOLAY</button><button onclick="setAchTab('medium')" class="h-tab-btn ${currentAchTab==='medium'?'active':''}">ğŸŸ¡ ORTA</button><button onclick="setAchTab('hard')" class="h-tab-btn ${currentAchTab==='hard'?'active':''}">ğŸ”´ ZOR</button></div>`; let filteredAch = []; if(currentAchTab === 'easy') filteredAch = achievements.filter(x => x.id.startsWith('e')); else if(currentAchTab === 'medium') filteredAch = achievements.filter(x => x.id.startsWith('m')); else filteredAch = achievements.filter(x => x.id.startsWith('h') || x.id.startsWith('i')); const listHTML = filteredAch.map(ach => { const isClaimed = claimed[ach.id]; return `<div class="ach-card-h ${isClaimed ? 'claimed' : ''}"><div class="text-2xl mb-1">${isClaimed ? 'âœ…' : 'ğŸ”’'}</div><p class="text-[10px] font-black text-white leading-tight mb-1">${ach.title}</p><p class="text-[8px] text-gray-400 mb-2 h-6 overflow-hidden">${ach.desc}</p>${isClaimed ? `<span class="text-[8px] text-green-500 font-bold">ALINDI</span>` : `<button onclick="claimAchievement('${ach.id}', ${ach.reward})" class="bg-red-600 text-[8px] px-2 py-1 rounded text-white font-bold animate-pulse">+${ach.reward} P</button>`}</div>`; }).join(''); document.getElementById('achievementList').innerHTML = tabsHTML + `<div class="h-scroll-wrapper">${listHTML}</div>`; };
        window.setAchTab = (t) => { window.currentAchTab = t; renderAchievements(); playSound('click'); };
        window.claimAchievement = (id, reward) => { const u = auth.currentUser; if(!u) return; addPointsSecure(reward, "BaÅŸarÄ±m: " + id); db.ref(`users/${u.uid}/achievements/${id}`).set(true); };

        window.renderShopNew = () => {
            const shopData = [
               {id:'goldName', name:'ALTIN Ä°SÄ°M', icon:'ğŸ‘‘', cost:500, type:'ozellik', desc:'AltÄ±n renkli isim'},
               {id:'neonFrame', name:'NEON Ã‡ERÃ‡EVE', icon:'ğŸŒˆ', cost:1000, type:'profil', desc:'Profil resmi parlasÄ±n'},
               {id:'rainbowName', name:'GÃ–KKUÅAÄI', icon:'ğŸŒŒ', cost:1500, type:'ozellik', desc:'Renkli isim efekti'},
               {id:'verified', name:'MAVÄ° TÄ°K', icon:'â˜‘ï¸', cost:2000, type:'ozellik', desc:'Onay rozeti'},
               {id:'fireFrame', name:'ALEVLÄ° PROFÄ°L', icon:'ğŸ”¥', cost:3000, type:'profil', desc:'YanÄ±p sÃ¶nen ateÅŸ'},
               {id:'xpBoost', name:'2X XP KARTI', icon:'âš¡', cost:5000, type:'boost', desc:'Seviye hÄ±zlandÄ±rÄ±cÄ±'},
               {id:'blueChat', name:'MAVÄ° SOHBET', icon:'ğŸ’¬', cost:5000, type:'ozellik', desc:'Mavi chat rengi'},
               {id:'ghostMode', name:'HAYALET MOD', icon:'ğŸ‘»', cost:5000, type:'ozellik', desc:'Listede gÃ¶rÃ¼nmez ol'},
               {id:'crownIcon', name:'KRAL TACI', icon:'ğŸ¤´', cost:10000, type:'profil', desc:'Ä°sminin yanÄ±na taÃ§'},
               {id:'invisMode', name:'GÃ–RÃœNMEZLÄ°K', icon:'ğŸ¥·', cost:15000, type:'boost', desc:'Tamamen gizli kal'}
            ];
            const cats = { 'profil': 'ğŸ‘¤ PROFÄ°L & Ã‡ERÃ‡EVE', 'ozellik': 'âœ¨ Ã–ZEL YETENEKLER', 'boost': 'ğŸš€ GÃœÃ‡LENDÄ°RÄ°CÄ°LER' };
            let fullHTML = `<div class="bg-zinc-900/50 p-4 rounded-2xl border border-yellow-500/20 mb-6"><p class="text-[10px] font-bold text-gray-400 uppercase">MEVCUT PUANIN</p><p class="text-3xl font-black text-white" id="shopUserPointsRef">${window.currentUserData?.points||0}</p></div>`;
            
            // Ä°HALE KARTI (Varsa GÃ¶ster)
            db.ref('public_data_v1/auction').on('value', s => {
                const a = s.val();
                if(a && a.end > Date.now()) {
                    document.getElementById('auctionPage').innerHTML = `<div class="auction-card"><h3 class="text-white font-black italic">ğŸ”¥ CANLI Ä°HALE ğŸ”¥</h3><p class="text-xs text-gray-300 mt-2">${a.item}</p><div class="auction-timer">BÄ°TÄ°Å: ${Math.floor((a.end - Date.now())/60000)}dk</div><p class="text-yellow-500 font-bold mb-2">TEKLÄ°F: ${a.bid} P (${a.bidder})</p><button onclick="bidAuction()" class="bg-red-600 text-white px-6 py-2 rounded-xl font-bold text-xs animate-pulse">TEKLÄ°F VER (+50)</button></div>`;
                    document.getElementById('auctionPage').classList.remove('hidden');
                } else document.getElementById('auctionPage').innerHTML = "";
            });

            // GÄ°ZLÄ° KASA KARTI
            fullHTML += `<div class="bg-red-900/20 p-4 rounded-2xl border border-red-500/50 mb-6"><h3 class="text-white font-black italic mb-2">ğŸ” GÄ°ZLÄ° SENSÄ° KASASI</h3><div class="space-y-2" id="vaultContainer"></div></div>`;
            
            // MAÄAZA Ä°TEMLERÄ°
            for (const [key, label] of Object.entries(cats)) {
                const items = shopData.filter(x => x.type === key);
                if(items.length > 0) {
                    fullHTML += `<div class="section-title-sm mt-4">${label}</div><div class="h-scroll-wrapper">`;
                    fullHTML += items.map(item => { const u = window.currentUserData; const isBought = u?.inventory?.[item.id]; return `<div class="shop-card-h ${isBought ? 'opacity-50' : ''}" onclick="${isBought ? '' : `buyItem('${item.id}', ${item.cost})`}"><div class="text-3xl mb-2">${item.icon}</div><div class="text-[9px] font-bold text-white leading-tight">${item.name}</div><div class="text-[8px] text-gray-500 mt-1">${item.desc}</div><div class="mt-auto ${isBought ? 'bg-zinc-700' : 'bg-yellow-500'} text-black text-[9px] font-black px-2 py-1 rounded-full w-full">${isBought ? 'SAHÄ°PSÄ°N' : item.cost + ' P'}</div></div>`; }).join('');
                    fullHTML += `</div>`;
                }
            }
            document.getElementById('shopContainerNew').innerHTML = fullHTML;
            renderVault();
        };

        window.openRoulette = () => { const u = window.currentUserData; if(u.lastDailyClaim === new Date().toDateString()) { showToast("YarÄ±n gel! ğŸ•’"); return; } document.getElementById('rouletteModal').style.display = 'flex'; };
        window.spinRoulette = () => { const btn = document.getElementById('spinBtn'); btn.disabled = true; const segments = [0, 10, 20, 50, 100, 500]; const randomSegmentIndex = Math.floor(Math.random() * segments.length); const points = segments[randomSegmentIndex]; const targetAngle = 30 + (randomSegmentIndex * 60); const totalRotation = 3600 + (360 - targetAngle); const wheel = document.getElementById('wheel'); wheel.style.transform = `rotate(${totalRotation}deg)`; let spinInterval = setInterval(() => playSound('spin'), 200); setTimeout(() => { clearInterval(spinInterval); const u = auth.currentUser; addPointsSecure(points, "GÃ¼nlÃ¼k Rulet"); db.ref(`users/${u.uid}/lastDailyClaim`).set(new Date().toDateString()); document.getElementById('rouletteModal').style.display = 'none'; wheel.style.transform = 'rotate(0deg)'; btn.disabled = false; }, 4000); };
        window.renderOutfitItems = (cat) => { const list = document.getElementById('outfitGrid'); document.querySelectorAll('.outfit-tab').forEach(t => t.classList.remove('active')); event.target.classList.add('active'); list.innerHTML = outfitData[cat].map(item => `<div class="outfit-item" onclick="selectOutfitItem('${cat}', '${item.id}', '${item.col||''}', '${item.icon||''}')"><div class="item-icon" style="color:${item.col.includes('gradient') ? 'white' : item.col}">${item.icon || 'ğŸ‘•'}</div><span>${item.name}</span></div>`).join(''); };
        window.selectOutfitItem = (cat, id, col, icon) => { currentOutfit[cat] = id; if(cat === 'head') document.getElementById('manHead').style.background = col; if(cat === 'mask') document.getElementById('manMask').innerText = icon; if(cat === 'body') document.getElementById('manBody').style.background = col; if(cat === 'legs') document.getElementById('manLegs').style.background = col; if(cat === 'shoes') { document.getElementById('shoeL').style.background = col; document.getElementById('shoeR').style.background = col; } calculateRarity(); playSound('click'); };
        window.calculateRarity = () => { let score = 0; if(currentOutfit.head === 'sakura') score += 20; const total = Math.min(100, score + Math.floor(Math.random() * 25)); document.getElementById('rarityScore').innerText = `%${total} EFSANEVÄ°`; };
        window.randomizeOutfit = () => { ['head', 'mask', 'body', 'legs', 'shoes'].forEach(c => { const item = outfitData[c][Math.floor(Math.random() * outfitData[c].length)]; selectOutfitItem(c, item.id, item.col, item.icon); }); showToast("Rastgele Kombin!"); };
        window.saveOutfit = () => { if(auth.currentUser) { showToast("Kaydedildi!"); playSound('success'); } };

        setTimeout(() => document.getElementById('loadingOverlay').style.display = 'none', 5000);
        db.ref('.info/connected').on('value', function(snap) { if (snap.val() === true) { db.ref('public_data_v1/devices').once('value').then(() => { const l = document.getElementById('loadingOverlay'); if(l) l.style.display = 'none'; }); const con = db.ref('online_sessions').push(); con.onDisconnect().remove(); con.set(true); } });
        db.ref('online_sessions').on('value', (snap) => { document.getElementById('liveUsers').innerText = snap.numChildren(); });
        db.ref('public_data_v1/devices').on('value', (s) => { window.devices = s.val() || []; document.getElementById('liveDevices').innerText = window.devices.length; refreshUI(); });
        db.ref('users').on('value', (snap) => { document.getElementById('liveMembers').innerText = snap.numChildren(); });
        db.ref('public_data_v1').on('value', (s) => { const d = s.val(); if(d) { window.interactions = d.interactions || {}; window.systemInviteCode = d.systemSettings?.inviteCode || "NPC2026"; if(d.announcement) document.getElementById('marqueeText').innerText = d.announcement; } });
        db.ref('public_data_v1/global_chat').limitToLast(50).on('value', (snapshot) => { const container = document.getElementById('chatContainer'); container.innerHTML = ""; const messages = []; snapshot.forEach(child => messages.push(child.val())); const myUid = auth.currentUser ? auth.currentUser.uid : ""; container.innerHTML = messages.map(msg => `<div class="chat-bubble ${msg.uid === myUid ? 'chat-mine' : 'chat-other'} flex flex-col"><span class="chat-user text-${msg.uid === myUid ? 'white' : 'red-500'} ${msg.goldName ? 'gold-name' : ''} ${msg.verified ? 'verified-badge' : ''} ${msg.rainbowName ? 'rainbow-name' : ''} ${msg.crownIcon ? 'crown-icon' : ''} ${msg.blueChat ? 'blue-chat-text' : ''}">${msg.user} <span class="text-[8px] opacity-70 bg-white/20 px-1 rounded text-white">${msg.rank}</span></span><span class="${msg.blueChat ? 'blue-chat-text' : ''}">${msg.text}</span><span class="chat-time text-gray-400">${msg.time}</span></div>`).join(''); container.scrollTop = container.scrollHeight; });
        db.ref('public_data_v1/rooms').on('value', s => { const l=[]; const now = Date.now(); s.forEach(x => { const r=x.val(); if(now - r.time < 1800000) l.push(r); else db.ref('public_data_v1/rooms/'+x.key).remove(); }); l.reverse(); document.getElementById('roomList').innerHTML = l.map(r => `<div class="room-card flex justify-between items-center"><div><span class="room-tag">${r.mode}</span> <b class="text-white text-xs ml-2">${r.id}</b><div class="text-[9px] text-gray-400 mt-1">Åifre: ${r.pass} | ${r.creator}</div></div><button onclick="navigator.clipboard.writeText('${r.id}');showToast('KopyalandÄ±!')" class="bg-zinc-700 p-2 rounded text-[10px] text-white">KOPYALA</button></div>`).join('') || '<div class="text-gray-500 text-xs text-center">Aktif oda yok.</div>'; });

        auth.onAuthStateChanged((user) => {
            if (user) {
                db.ref('users/' + user.uid).on('value', (s) => {
                    const data = s.val();
                    if (data && data.banned === true) { auth.signOut(); location.reload(); return; }
                    window.currentUserData = data;
                    updateProfileUI();
                    if(data.squad) { 
                        document.getElementById('noSquadPanel').classList.add('hidden'); document.getElementById('mySquadPanel').classList.remove('hidden'); document.getElementById('squadTitle').innerText = data.squad; 
                        db.ref(`public_data_v1/squads/${data.squad}`).on('value', sq => { document.getElementById('squadTotalPoints').innerText = sq.val()?.points || 0; });
                        db.ref(`public_data_v1/squads/${data.squad}/chat`).limitToLast(20).on('value', ss => { const box = document.getElementById('squadChat'); box.innerHTML = ""; ss.forEach(m => { const v = m.val(); box.innerHTML += `<div class="text-[10px] text-white"><b class="text-purple-400">${v.user}:</b> ${v.text}</div>`; }); box.scrollTop = box.scrollHeight; }); 
                    } else { document.getElementById('noSquadPanel').classList.remove('hidden'); document.getElementById('mySquadPanel').classList.add('hidden'); }
                });
                document.getElementById('loginOverlay').classList.add('hidden'); document.getElementById('mainNav').classList.remove('hidden'); navigate('platformPage'); renderOutfitItems('head');
            } else { document.getElementById('loginOverlay').classList.remove('hidden'); document.getElementById('mainNav').classList.add('hidden'); }
        });

        window.updateProfileUI = () => {
            const u = window.currentUserData; if(!u) return;
            if (auth.currentUser && auth.currentUser.uid === REAL_ADMIN_UID) document.getElementById('platformAdminBtn').style.display = 'block';
            document.getElementById('uNameDisplay').innerText = u.username;
            document.getElementById('userRank').innerText = u.rank;
            document.getElementById('userStats').innerText = u.points || 0;
            document.getElementById('userAvatarImg').src = u.avatar || "https://cdn-icons-png.flaticon.com/512/847/847969.png";
            document.getElementById('userBio').innerText = u.bio || "HenÃ¼z biyografi yok...";
            if(document.getElementById('flagDisplay')) document.getElementById('flagDisplay').innerText = u.flag || "ğŸŒ";
            if(document.getElementById('favWeaponsDisplay')) document.getElementById('favWeaponsDisplay').innerText = (u.favWeapons || ["SeÃ§ilmedi"]).join(" | ");
            renderAchievements();
            const inv = u.inventory || {};
            const nameDisplay = document.getElementById('uNameDisplay'); const avatarWrapper = document.querySelector('.profile-avatar-wrapper');
            if(inv.goldName) nameDisplay.classList.add('gold-name'); if(inv.rainbowName) nameDisplay.classList.add('rainbow-name'); if(inv.crownIcon) nameDisplay.classList.add('crown-icon'); if(inv.neonFrame) avatarWrapper.classList.add('neon-border'); if(inv.fireFrame) avatarWrapper.classList.add('fire-border');
            document.getElementById('followingCount').innerText = u.following ? Object.keys(u.following).length : 0; document.getElementById('followerCount').innerText = u.followers ? Object.keys(u.followers).length : 0;
        };

        window.buyItem = (item, cost) => { const u = auth.currentUser; if(!u || !window.currentUserData) return; const pts = window.currentUserData.points || 0; const inv = window.currentUserData.inventory || {}; if(inv[item]) { showToast("Zaten Sahipsin!"); return; } if(pts < cost) { showToast("Yetersiz Puan!"); return; } if(confirm(`${cost} Puan harcanacak?`)) { db.ref(`users/${u.uid}/points`).set(pts - cost); db.ref(`users/${u.uid}/inventory/${item}`).set(true); showToast("SatÄ±n Alma BaÅŸarÄ±lÄ±! ğŸ‰"); playSound('success'); renderShopNew(); } };
        window.quickBrandFilter = (brand) => { currentFilterBrand = brand; applyFilters(); playSound('click'); }
        window.showToast = (msg) => { const t = document.getElementById('toast'); document.getElementById('toastMsg').innerText = msg; t.classList.add('toast-show'); setTimeout(() => t.classList.remove('toast-show'), 3000); playSound('success'); }
        window.openCategory = (c) => { 
            document.getElementById('catTitle').innerText = c; currentCat = c; currentFilterBrand = "TÃœMÃœ";
            let brands = []; if(c === 'ANDROID') brands = ['XIAOMI', 'SAMSUNG', 'HUAWEI', 'OPPO', 'VIVO']; else if(c === 'IOS') brands = ['IPHONE', 'IPAD']; else if(c === 'PC') brands = ['MSI', 'BLUESTACKS'];
            const brandHTML = `<button onclick="quickBrandFilter('TÃœMÃœ')" class="flex-shrink-0 bg-red-600 text-white px-3 py-1 rounded text-[10px] font-bold">TÃœMÃœ</button>` + brands.map(b => `<button onclick="quickBrandFilter('${b}')" class="flex-shrink-0 bg-white/10 text-white px-3 py-1 rounded text-[10px] font-bold hover:bg-white/20">${b}</button>`).join('');
            document.getElementById('brandFilterContainer').innerHTML = `<div class="flex gap-2 overflow-x-auto pb-2">${brandHTML}</div>`;
            applyFilters(); navigate('homePage'); playSound('click'); 
        }
        window.filterSmart = (type) => { let list = window.devices; if(type === 'pro') list = list.filter(d => d.gen > 90 && d.x2 > 90); if(type === 'high') list = list.filter(d => d.gen === 100); renderDeviceList(list); showToast(`${type.toUpperCase()} Filtresi!`); };
        window.applyFilters = () => { let list = window.devices.filter(d => (d.cat||"").toUpperCase() === currentCat); if(currentFilterBrand !== "TÃœMÃœ") list = list.filter(d => window.detectBrand(d.name) === currentFilterBrand); renderDeviceList(list); }
        window.detectBrand = (n) => { n=n.toUpperCase(); if(n.includes("IPHONE"))return "IPHONE"; if(n.includes("IPAD"))return "IPAD"; if(n.includes("SAMSUNG"))return "SAMSUNG"; if(n.includes("REDMI")||n.includes("POCO")||n.includes("XIAOMI"))return "XIAOMI"; if(n.includes("HUAWEI"))return "HUAWEI"; return "DÄ°ÄER"; }
        window.changeAvatar = () => document.getElementById('avatarInput').click();
        window.editBio = () => { const currentBio = window.currentUserData.bio || ""; openCustomPrompt("BÄ°YOGRAFÄ°NÄ° YAZ", currentBio, (newBio) => { if(newBio) { db.ref(`users/${auth.currentUser.uid}/bio`).set(newBio); showToast("Bio GÃ¼ncellendi!"); } }); };
        window.switchProfileTab = (tab) => { document.querySelectorAll('.p-tab-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active'); if(tab === 'info') { document.getElementById('tab-info').classList.remove('hidden'); document.getElementById('tab-leaderboard').classList.add('hidden'); } else { document.getElementById('tab-info').classList.add('hidden'); document.getElementById('tab-leaderboard').classList.remove('hidden'); loadLeaderboard(); } playSound('click'); };
        window.renderDeviceList = (l) => { const container = document.getElementById('deviceGrid'); if(l.length === 0) { container.innerHTML = '<div class="text-center opacity-50 text-xs py-10">CÄ°HAZ BULUNAMADI</div>'; return; } container.innerHTML = l.map(d => `<div class="menu-card flex justify-between items-center" onclick="openDetail('${d.id}'); playSound('click')"><div class="flex flex-col"><span class="font-black text-sm uppercase text-white tracking-tight">${d.name}</span><div class="flex gap-3 text-[10px] font-bold mt-1 opacity-90"><span class="text-green-400">ğŸ”¥ ${window.interactions[d.id]?.likes ? Object.keys(window.interactions[d.id].likes).length : 0}</span><span class="text-red-400">ğŸ’© ${window.interactions[d.id]?.dislikes ? Object.keys(window.interactions[d.id].dislikes).length : 0}</span></div></div><button class="text-xl hover:scale-125 transition text-white">â¡ï¸</button></div>`).join(''); }
        window.openAdmin = () => { const u = auth.currentUser; if(u && u.uid === REAL_ADMIN_UID) { document.getElementById('adminModal').style.display='flex'; document.getElementById('currentInviteDisplay').innerText = window.systemInviteCode; } else { showToast("YETKÄ°SÄ°Z!"); } }
        window.handleAuth = () => { const u = document.getElementById('userInput').value.trim().toLowerCase().replace(/\s/g, ''); const p = document.getElementById('passInput').value; const inv = document.getElementById('inviteInput').value; if(!u || !p) return; const email = u + "@npc.gen.tr"; if(window.isRegisterMode) { if(inv !== window.systemInviteCode) return alert("Davet kodu yanlÄ±ÅŸ!"); auth.createUserWithEmailAndPassword(email, p).then(c => db.ref('users/'+c.user.uid).set({username:u, rank:"BRONZE NPC", points:0})).catch(e=>alert(e.message)); } else { auth.signInWithEmailAndPassword(email, p).catch(e=>alert("GiriÅŸ HatasÄ±")); } };
        window.handleLogout = () => auth.signOut().then(() => location.reload());
        window.toggleAuthMode = () => { window.isRegisterMode = !window.isRegisterMode; document.getElementById('authBtn').innerText = window.isRegisterMode ? "HESAP OLUÅTUR" : "GÄ°RÄ°Å YAP"; document.getElementById('inviteInput').classList.toggle('hidden'); };
        window.resetPassword = () => { const u = document.getElementById('userInput').value.trim(); if(!u) return alert("KullanÄ±cÄ± adÄ± yaz!"); auth.sendPasswordResetEmail(u+"@npc.gen.tr").then(()=>alert("Mail gÃ¶nderildi!")).catch(e=>alert(e.message)); };
        window.addMassiveDevices = async () => { if(!confirm("200+ Cihaz?")) return; const l = window.devices||[]; ["Redmi Note 10","iPhone 13","Samsung S21"].forEach(x=>l.push({id:Date.now()+Math.random(), cat:"ANDROID", name:x, gen:100, red:100, x2:100, x4:100, fire:40})); db.ref('public_data_v1/devices').set(l).then(()=>showToast("Eklendi!")); }
        window.adminAddDevice = () => { const n = document.getElementById('adName').value; if(n) { const d = {id:Date.now().toString(), cat:document.getElementById('adCat').value, name:n, img:tempAdImgUrl, vid:document.getElementById('adVid').value, gen:100, red:100, x2:100, x4:100, fire:40}; const l=window.devices||[]; l.push(d); db.ref('public_data_v1/devices').set(l).then(()=>showToast("Eklendi!")); tempAdImgUrl=""; } };
        window.updateMarquee = () => { const txt = document.getElementById('announceInput').value; if(txt) db.ref('public_data_v1/announcement').set(txt).then(()=>showToast("Duyuru GÃ¼ncellendi!")); };
        window.sendChatMessage = () => { const txt = document.getElementById('chatInput').value.trim(); if(!txt) return; const inv = window.currentUserData.inventory || {}; const msg = { user: window.currentUserData.username, uid: auth.currentUser.uid, rank: window.currentUserData.rank.split(' ')[0], text: txt, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), goldName: inv.goldName || false, rainbowName: inv.rainbowName || false, verified: inv.verified || false, crownIcon: inv.crownIcon || false, blueChat: inv.blueChat || false }; db.ref('public_data_v1/global_chat').push(msg); document.getElementById('chatInput').value=""; playSound('click'); }
        window.loadLeaderboard = () => { db.ref('users').orderByChild('points').limitToLast(10).once('value', (snap) => { const l=[]; snap.forEach(c=>l.push({key:c.key,...c.val()})); l.reverse(); document.getElementById('leaderList').innerHTML=l.map((u,i)=>`<div class="leader-item animate-fade-in flex items-center gap-3 p-4 bg-zinc-900/50 rounded-xl mb-2 border border-white/10"><span class="font-black text-lg text-red-600">#${i+1}</span><img src="${u.avatar||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" class="w-10 h-10 rounded-full object-cover border border-red-600/30"><div class="text-left"><p class="text-xs font-black uppercase text-white ${u.inventory?.goldName ? 'gold-name' : ''} ${u.inventory?.rainbowName ? 'rainbow-name' : ''}">${u.username}</p><p class="text-[9px] text-gray-400 font-bold">${u.points||0} Puan</p></div>${u.key===auth.currentUser.uid?'':`<button onclick="toggleFollow('${u.key}'); playSound('click')" class="ml-auto text-[9px] font-bold px-3 py-1 rounded-full bg-red-600 text-white shadow-md">TAKÄ°P</button>`}</div>`).join(''); }); };
        window.toggleFollow = (tid) => { const mid=auth.currentUser.uid; db.ref(`users/${mid}/following/${tid}`).set(true); db.ref(`users/${tid}/followers/${mid}`).set(true); showToast("Takip Edildi!"); setTimeout(loadLeaderboard,300); };
        window.renderVS = () => { const id1 = document.getElementById('vsSelect1').value; const id2 = document.getElementById('vsSelect2').value; if(id1 && id2) { const d1 = window.devices.find(d => d.id === id1); const d2 = window.devices.find(d => d.id === id2); document.getElementById('vsResult').innerHTML = `<div class="vs-card"><h3 class="font-black text-xs mb-2 text-white">${d1.name}</h3>${renderVsBar("Genel", d1.gen)} ${renderVsBar("Red Dot", d1.red)}</div><div class="vs-card"><h3 class="font-black text-xs mb-2 text-white">${d2.name}</h3>${renderVsBar("Genel", d2.gen)} ${renderVsBar("Red Dot", d2.red)}</div>`; document.getElementById('vsResult').classList.remove('opacity-0'); } };
        function renderVsBar(label, val, max=200) { return `<div class="text-[9px] text-left mt-2 text-gray-300 font-bold">${label}: ${val}</div><div class="vs-bar-bg"><div class="vs-bar-fill" style="width:${(val/max)*100}%"></div></div>`; }
        window.populateVSSelects = () => { const opts = window.devices.map(d=>`<option value="${d.id}">${d.name}</option>`).join(''); document.getElementById('vsSelect1').innerHTML='<option value="">1. SeÃ§</option>'+opts; document.getElementById('vsSelect2').innerHTML='<option value="">2. SeÃ§</option>'+opts; };
        window.navigate = (id) => { document.querySelectorAll('.page').forEach(p => p.classList.add('page-hidden')); document.getElementById(id).classList.remove('page-hidden'); document.querySelectorAll('.nav-icon').forEach(i=>i.classList.remove('active')); if(id==='leaderboardPage') loadLeaderboard(); if(id==='vsPage') populateVSSelects(); if(id==='shopPage') renderShopNew(); if(id==='hudPage') renderHUDs(); if(id==='quizPage') startQuiz(); if(id==='cardPage') updateCard(); playSound('click'); }
        window.searchDevices = () => { const q = document.getElementById('searchInput').value.toLowerCase(); const g = document.getElementById('platformGrid'); const l = document.getElementById('searchResultList'); if(q.length > 0) { g.classList.add('hidden'); l.classList.remove('hidden'); const f = window.devices.filter(d => d.name.toLowerCase().includes(q)); l.innerHTML = f.map(d => `<div class="menu-card flex justify-between items-center" onclick="openDetail('${d.id}'); playSound('click')"><div class="flex flex-col"><span class="font-black text-sm uppercase text-white tracking-tight">${d.name}</span><div class="flex gap-3 text-[10px] font-bold mt-1 opacity-90"><span class="text-green-400">ğŸ”¥ ${window.interactions[d.id]?.likes ? Object.keys(window.interactions[d.id].likes).length : 0}</span></div></div><button class="text-xl hover:scale-125 transition text-white">â¡ï¸</button></div>`).join('') || '<div class="text-center opacity-40 py-10 font-bold text-xs text-white">SONUÃ‡ YOK</div>'; } else { g.classList.remove('hidden'); l.classList.add('hidden'); } }
        
        window.openDetail = (id) => { 
            window.activeId = id; const d = window.devices.find(x => x.id === id); 
            let media = ""; if(d.img) media += `<div class="bg-zinc-900 rounded-[35px] mb-6 overflow-hidden shadow-2xl border border-white/5"><img src="${d.img}" class="w-full h-56 object-cover"></div>`; 
            const proSettings = getProSettings(d.cat); const proHTML = proSettings.map(s => `<div class="pro-item"><span>${s.l}</span><span class="pro-val">${s.v}</span></div>`).join('');
            document.getElementById('detailContent').innerHTML = `${media}<h2 class="text-3xl font-black text-red-600 italic text-center mb-8 uppercase tracking-tighter">${d.name}</h2><div class="bg-zinc-900/5 p-8 rounded-[40px] border border-red-600/10 space-y-7 shadow-lg backdrop-blur-md">${renderSlider("GENEL", d.gen||100)}${renderSlider("RED DOT", d.red||100)}${renderSlider("2X", d.x2||100)}${renderSlider("4X", d.x4||100)}<div class="text-center bg-red-600/10 p-5 rounded-2xl border border-red-600/20 font-black text-sm text-red-600">ATEÅ TUÅU: %${d.fire||40}</div></div><div class="mt-6 pro-settings-box"><p class="text-[10px] text-blue-400 font-black uppercase mb-3 tracking-widest">âš ï¸ GÄ°ZLÄ° PRO AYARLARI</p>${proHTML}</div>`;
            db.ref(`public_data_v1/interactions/${id}/likes`).on('value', s => { document.getElementById('likeCountDetail').innerText = s.numChildren(); });
            db.ref(`public_data_v1/interactions/${id}/dislikes`).on('value', s => { document.getElementById('disCountDetail').innerText = s.numChildren(); });
            db.ref(`public_data_v1/interactions/${id}/comments`).on('value', s => { const list = []; s.forEach(c => list.push(c.val())); list.reverse(); document.getElementById('commentBox').innerHTML = list.map(k => `<div class="p-3 bg-zinc-900/80 rounded-xl mb-2 border-l-2 border-red-600 shadow-md"><b class="text-[10px] text-red-500 uppercase block mb-1 font-black">${k.user}</b><span class="text-xs text-gray-300 font-bold">${k.msg}</span></div>`).join('') || '<div class="text-gray-500 text-xs text-center py-2">Ä°lk yorumu sen yap!</div>'; });
            navigate('detailPage'); 
        }

        function renderSlider(l, v) { return `<div><div class="flex justify-between text-[10px] font-black text-white uppercase mb-2 shadow-black drop-shadow-md"><span>${l}</span><span>${v}</span></div><div class="ff-slider-bg"><div class="ff-slider-fill" style="width:${(v/200)*100}%"></div></div></div>`; }
        window.refreshUI = () => { if(window.activeId) { } }
        window.clearChat = () => { db.ref('public_data_v1/global_chat').remove().then(()=>showToast("Sohbet Temizlendi!")); };
        window.openCountrySelector = () => { openCustomPrompt("BAYRAK SEÃ‡ (0-9)", "0", (val) => { const flags = ["ğŸ‡¹ğŸ‡·", "ğŸ‡¦ğŸ‡¿", "ğŸ‡ºğŸ‡¸", "ğŸ‡§ğŸ‡·", "ğŸ‡®ğŸ‡³", "ğŸ‡ªğŸ‡¸", "ğŸ‡·ğŸ‡º", "ğŸ‡®ğŸ‡©", "ğŸ‡¯ğŸ‡µ", "ğŸ‡°ğŸ‡·"]; const idx = parseInt(val); if(flags[idx]) { db.ref(`users/${auth.currentUser.uid}/flag`).set(flags[idx]); showToast("Bayrak GÃ¼ncellendi!"); setTimeout(window.updateProfileUI, 500); } }); };
        window.openWeaponSelector = () => { const ffWeapons = ["ê§à¼ºM1887à¼»ê§‚", "âš¡MP40-COBRAâš¡", "ğŸ”¥AK47-DRAGONğŸ”¥", "ğŸ¦…DESERT EAGLEğŸ¦…", "ğŸ¯AWM-SNIPERğŸ¯", "ğŸ’€M1014-DEATHğŸ’€", "ğŸ›¡ï¸SCAR-TITANğŸ›¡ï¸", "ğŸ‰XM8-PUMPKINğŸ‰"]; openCustomPrompt("3 SÄ°LAH SEÃ‡ (0,1,2)", "0,1,2", (val) => { const idxs = val.split(',').map(x => parseInt(x)); const selected = idxs.map(i => ffWeapons[i]).filter(x => x).slice(0,3); db.ref(`users/${auth.currentUser.uid}/favWeapons`).set(selected); showToast("KuÅŸatÄ±ldÄ±!"); setTimeout(window.updateProfileUI, 500); }); };

        /* --- REFLEX GOD --- */
        let reflexStartTime = 0; let reflexTimer = null; let isReflexActive = false; let currentReflexMode = 'easy';
        window.startReflexGame = (mode) => { currentReflexMode = mode; document.getElementById('reflexStartScreen').classList.add('hidden'); document.getElementById('reflexResult').classList.add('hidden'); document.getElementById('reflexTarget').classList.add('hidden'); document.getElementById('reflexWaitMsg').classList.remove('hidden'); const area = document.getElementById('reflexArea'); area.onmousedown = () => { if(!isReflexActive) { clearTimeout(reflexTimer); showToast("âš ï¸ ERKEN BASTIN!"); playSound('error'); resetReflexUI(); } }; const randomDelay = Math.floor(Math.random() * 2500) + 1500; reflexTimer = setTimeout(() => { spawnReflexTarget(); }, randomDelay); };
        function spawnReflexTarget() { isReflexActive = true; document.getElementById('reflexWaitMsg').classList.add('hidden'); const target = document.getElementById('reflexTarget'); const area = document.getElementById('reflexArea'); let size = 60; let color = '#22c55e'; if(currentReflexMode === 'hard') { size = 30; color = '#f97316'; } else if(currentReflexMode === 'impossible') { size = 12; color = '#9333ea'; } target.style.width = size + "px"; target.style.height = size + "px"; target.style.backgroundColor = color; target.style.boxShadow = `0 0 15px ${color}`; const maxX = area.clientWidth - size; const maxY = area.clientHeight - size; const randX = Math.floor(Math.random() * maxX); const randY = Math.floor(Math.random() * maxY); target.style.left = randX + "px"; target.style.top = randY + "px"; target.classList.remove('hidden'); reflexStartTime = Date.now(); playSound('click'); }
        window.hitReflexTarget = (e) => { if(e) e.stopPropagation(); if(!isReflexActive) return; const reactionTime = Date.now() - reflexStartTime; isReflexActive = false; finishReflexGame(reactionTime); };
        function finishReflexGame(ms) { document.getElementById('reflexTarget').classList.add('hidden'); document.getElementById('reflexResult').classList.remove('hidden'); document.getElementById('reflexMs').innerText = ms; let rank = ""; let color = ""; let points = 0; if(currentReflexMode === 'impossible') { if(ms < 300) { rank = "ğŸ’€ HACKER"; points = 100; } else if(ms < 500) { rank = "ğŸ”¥ EFSANE"; points = 50; } else { rank = "âœ… BAÅARILI"; points = 20; } } else if(currentReflexMode === 'hard') { if(ms < 200) { rank = "âš¡ E-SPORCU"; points = 40; } else { rank = "ğŸ˜ NORMAL"; points = 5; } } else { if(ms < 200) { rank = "ğŸš€ HIZLI"; points = 10; } } document.getElementById('reflexRank').innerText = rank; if(points > 0) window.addPointsSecure(points, `Reflex`); playSound(ms < 300 ? 'success' : 'click'); }
        window.resetReflexUI = () => { isReflexActive = false; clearTimeout(reflexTimer); document.getElementById('reflexResult').classList.add('hidden'); document.getElementById('reflexWaitMsg').classList.add('hidden'); document.getElementById('reflexTarget').classList.add('hidden'); document.getElementById('reflexStartScreen').classList.remove('hidden'); };

        /* --- FAST AIM --- */
        let fastAimScore = 0; let fastAimTime = 30; let fastAimTimer = null; let fastAimActive = false;
        window.startFastAimGame = () => { if(fastAimActive) return; fastAimActive = true; fastAimScore = 0; fastAimTime = 30; document.getElementById('fastAimScore').innerText = 0; document.getElementById('fastAimTime').innerText = 30; document.getElementById('fastAimStartBtn').classList.add('hidden'); spawnFastAimTarget(); fastAimTimer = setInterval(() => { fastAimTime--; document.getElementById('fastAimTime').innerText = fastAimTime; if(fastAimTime <= 0) { endFastAimGame(); } }, 1000); };
        window.spawnFastAimTarget = () => { if(!fastAimActive) return; const area = document.getElementById('fastAimArea'); const target = document.getElementById('fastAimTarget'); const maxX = area.clientWidth - 40; const maxY = area.clientHeight - 40; target.style.left = Math.random() * maxX + 'px'; target.style.top = Math.random() * maxY + 'px'; target.classList.remove('hidden'); target.style.transform = 'scale(1)'; };
        window.hitFastAim = (e) => { e.stopPropagation(); if(!fastAimActive) return; fastAimScore++; document.getElementById('fastAimScore').innerText = fastAimScore; playSound('click'); const target = document.getElementById('fastAimTarget'); target.style.transform = 'scale(0)'; setTimeout(() => { spawnFastAimTarget(); }, 100); };
        window.endFastAimGame = () => { clearInterval(fastAimTimer); fastAimActive = false; document.getElementById('fastAimStartBtn').classList.remove('hidden'); document.getElementById('fastAimTarget').classList.add('hidden'); showToast(`SKORUN: ${fastAimScore}`); addPointsSecure(fastAimScore * 5, "Fast Aim Skor"); playSound('success'); };
    </script>
</body>
</html>